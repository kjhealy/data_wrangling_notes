<!DOCTYPE html>
<html lang="en"><head>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-html/tabby.min.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/light-border.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-5acd1f5414a849314995cb65ca2adae1.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<link href="../site_libs/quarto-contrib/line-highlight-1.0.0/line-highlight.css" rel="stylesheet">
<link href="../site_libs/quarto-contrib/fonts-0.0/fonts-embed.css" rel="stylesheet"><meta charset="utf-8">
  <meta name="generator" content="quarto-1.8.25">

  <meta name="author" content="Kieran Healy">
  <title>Data Wrangling with R and the Tidyverse – Reading in Data</title>
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">
  <link rel="stylesheet" href="../site_libs/revealjs/dist/reset.css">
  <link rel="stylesheet" href="../site_libs/revealjs/dist/reveal.css">
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      width: 0.8em;
      margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
      vertical-align: middle;
    }
    /* CSS for syntax highlighting */
    html { -webkit-text-size-adjust: 100%; }
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
      }
    pre.numberSource { margin-left: 3em;  padding-left: 4px; }
    div.sourceCode
      { color: #f5bde6; background-color: #24273a; }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span { color: #cad3f5; } /* Normal */
    code span.al { color: #ed8796; font-weight: bold; } /* Alert */
    code span.an { color: #eed49f; } /* Annotation */
    code span.at { color: #b7bdf8; } /* Attribute */
    code span.bn { color: #ed8796; } /* BaseN */
    code span.bu { color: #ed8796; } /* BuiltIn */
    code span.cf { color: #c6a0f6; } /* ControlFlow */
    code span.ch { color: #f5bde6; } /* Char */
    code span.cn { color: #8aadf4; } /* Constant */
    code span.co { color: #6e738d; font-style: italic; } /* Comment */
    code span.cv { color: #6e738d; font-style: italic; } /* CommentVar */
    code span.do { color: #ed8796; } /* Documentation */
    code span.dt { color: #c6a0f6; } /* DataType */
    code span.dv { color: #f5a97f; } /* DecVal */
    code span.er { color: #ed8796; text-decoration: underline; } /* Error */
    code span.ex { color: #8aadf4; } /* Extension */
    code span.fl { color: #f5a97f; } /* Float */
    code span.fu { color: #8aadf4; } /* Function */
    code span.im { color: #a6da95; } /* Import */
    code span.in { color: #f5a97f; } /* Information */
    code span.kw { color: #c6a0f6; } /* Keyword */
    code span.op { color: #91d7e3; } /* Operator */
    code span.ot { color: #f5a97f; } /* Other */
    code span.pp { color: #f5bde6; } /* Preprocessor */
    code span.re { color: #6e738d; font-style: italic; } /* RegionMarker */
    code span.sc { color: #f5bde6; } /* SpecialChar */
    code span.ss { color: #ed8796; } /* SpecialString */
    code span.st { color: #a6da95; } /* String */
    code span.va { color: #f5bde6; } /* Variable */
    code span.vs { color: #ed8796; } /* VerbatimString */
    code span.wa { color: #f5a97f; } /* Warning */
  </style>
  <link rel="stylesheet" href="../site_libs/revealjs/dist/theme/quarto-d7aba44a31fe39c51a22e6209b6cfdeb.css">
  <link href="../site_libs/revealjs/plugin/quarto-line-highlight/line-highlight.css" rel="stylesheet">
  <link href="../site_libs/revealjs/plugin/reveal-menu/menu.css" rel="stylesheet">
  <link href="../site_libs/revealjs/plugin/reveal-menu/quarto-menu.css" rel="stylesheet">
  <link href="../site_libs/revealjs/plugin/quarto-support/footer.css" rel="stylesheet">
  <style type="text/css">
    .reveal div.sourceCode {
      margin: 0;
      overflow: auto;
    }
    .reveal div.hanging-indent {
      margin-left: 1em;
      text-indent: -1em;
    }
    .reveal .slide:not(.center) {
      height: 100%;
    }
    .reveal .slide.scrollable {
      overflow-y: auto;
    }
    .reveal .footnotes {
      height: 100%;
      overflow-y: auto;
    }
    .reveal .slide .absolute {
      position: absolute;
      display: block;
    }
    .reveal .footnotes ol {
      counter-reset: ol;
      list-style-type: none; 
      margin-left: 0;
    }
    .reveal .footnotes ol li:before {
      counter-increment: ol;
      content: counter(ol) ". "; 
    }
    .reveal .footnotes ol li > p:first-child {
      display: inline-block;
    }
    .reveal .slide ul,
    .reveal .slide ol {
      margin-bottom: 0.5em;
    }
    .reveal .slide ul li,
    .reveal .slide ol li {
      margin-top: 0.4em;
      margin-bottom: 0.2em;
    }
    .reveal .slide ul[role="tablist"] li {
      margin-bottom: 0;
    }
    .reveal .slide ul li > *:first-child,
    .reveal .slide ol li > *:first-child {
      margin-block-start: 0;
    }
    .reveal .slide ul li > *:last-child,
    .reveal .slide ol li > *:last-child {
      margin-block-end: 0;
    }
    .reveal .slide .columns:nth-child(3) {
      margin-block-start: 0.8em;
    }
    .reveal blockquote {
      box-shadow: none;
    }
    .reveal .tippy-content>* {
      margin-top: 0.2em;
      margin-bottom: 0.7em;
    }
    .reveal .tippy-content>*:last-child {
      margin-bottom: 0.2em;
    }
    .reveal .slide > img.stretch.quarto-figure-center,
    .reveal .slide > img.r-stretch.quarto-figure-center {
      display: block;
      margin-left: auto;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-left,
    .reveal .slide > img.r-stretch.quarto-figure-left  {
      display: block;
      margin-left: 0;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-right,
    .reveal .slide > img.r-stretch.quarto-figure-right  {
      display: block;
      margin-left: auto;
      margin-right: 0; 
    }
  </style>
</head>
<body class="quarto-light">
  <div class="reveal">
    <div class="slides">

<section id="title-slide" data-background-color="#252F3E" class="quarto-title-block center">
  <h1 class="title">Reading in Data</h1>
  <p class="subtitle">Data Wrangling, Session 6</p>

<div class="quarto-title-authors">
<div class="quarto-title-author">
<div class="quarto-title-author-name">
Kieran Healy 
</div>
        <p class="quarto-title-affiliation">
            Code Horizons
          </p>
    </div>
</div>

  <p class="date">January 2026</p>
</section>
<section>
<section id="reading-in-data-with-readr-and-haven" class="title-slide slide level1 inv-title center" data-background-color="#252F3E">
<h1>Reading in data with <span class="fg-yellow">readr</span> and <span class="fg-yellow">haven</span></h1>

</section>
<section id="load-the-packages-as-always" class="slide level2">
<h2>Load the packages, as always</h2>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb1" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(here)      <span class="co"># manage file paths</span></span>
<span id="cb1-2"><a aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(socviz)    <span class="co"># data and some useful functions</span></span>
<span id="cb1-3"><a aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse) <span class="co"># your friend and mine</span></span>
<span id="cb1-4"><a aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(haven)     <span class="co"># for Stata, SAS, and SPSS files</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section class="slide level2">

<div class="huge">
<p><span class="fg-orange">We’ve put a lot of pieces in place at this point</span></p>
</div>
<p>Including several things we haven’t fully exploited yet</p>
</section>
<section id="data-we-want-to-get-into-r" class="slide level2">
<h2>Data we want to get into R</h2>
<ul>
<li class="fragment">Nice, clean CSV files.</li>
<li class="fragment">More troublesome CSVs.</li>
<li class="fragment">Other plain-text formats.</li>
<li class="fragment">Foreign formats, like Stata.</li>
<li class="fragment">Quite messy things like tables on web pages.</li>
<li class="fragment">… and more besides.</li>
</ul>
</section>
<section id="reading-in-csv-files" class="slide level2">
<h2>Reading in CSV files</h2>
<ul>
<li class="fragment">CSV is not really a proper format at all!</li>
<li class="fragment">Base R has <span class="fg-green"><code>read.csv()</code></span></li>
<li class="fragment">Corresponding tidyverse “underscored” version: <span class="fg-green"><code>read_csv()</code></span>.</li>
<li class="fragment">It is pickier and more talkative than the Base R version.</li>
</ul>
</section>
<section id="wheres-the-data-using-here" class="slide level2">
<h2>Where’s the data? Using <span class="fg-green">here()</span></h2>
<ul>
<li>If we’re loading a file, it’s coming from <em>somewhere</em>.</li>
<li>If it’s on our local disk somewhere, we will need to interact with the file system. We should try to do this in a way that avoids <em>absolute</em> file paths.</li>
</ul>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb2" data-code-line-numbers=""><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a aria-hidden="true" tabindex="-1"></a><span class="co"># This is not portable</span></span>
<span id="cb2-2"><a aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"/Users/kjhealy/Documents/data/misc/project/data/mydata.csv"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="wheres-the-data-using-here-1" class="slide level2">
<h2>Where’s the data? Using <span class="fg-green">here()</span></h2>
<ul>
<li>If we’re loading a file, it’s coming from <em>somewhere</em>.</li>
<li>If it’s on our local disk somewhere, we will need to interact with the file system. We should try to do this in a way that avoids <em>absolute</em> file paths.</li>
</ul>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb3" data-code-line-numbers=""><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a aria-hidden="true" tabindex="-1"></a><span class="co"># This is not portable</span></span>
<span id="cb3-2"><a aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"/Users/kjhealy/Documents/data/misc/project/data/mydata.csv"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<ul>
<li>We should also do it in a way that is <em>platform independent</em>.</li>
<li>This makes it easier to share your work, move it around, etc. Projects should be self-contained.</li>
</ul>
</section>
<section id="wheres-the-data-using-here-2" class="slide level2">
<h2>Where’s the data? Using <span class="fg-green">here()</span></h2>
<ul>
<li>The <code>here</code> package, and <span class="fg-green"><strong><code>here()</code></strong></span> function builds paths relative to the top level of your R project.</li>
</ul>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb4" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a aria-hidden="true" tabindex="-1"></a><span class="fu">here</span>() <span class="co"># this path will be different for you</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre data-code-line-numbers=""><code>[1] "/Users/kjhealy/Documents/courses/data_wrangling"</code></pre>
</div>
</div>
</section>
<section id="wheres-the-data-using-here-3" class="slide level2">
<h2>Where’s the data? Using <span class="fg-green">here()</span></h2>
<ul>
<li>This seminar’s files all live in an RStudio project. It looks like this:</li>
</ul>
<div class="cell" data-layout-align="center">
<div class="cell-output cell-output-stdout">
<pre data-code-line-numbers=""><code>/Users/kjhealy/Documents/courses/data_wrangling
├── LICENSE
├── Makefile
├── README.md
├── README.qmd
├── _extensions
├── _freeze
├── _quarto.yml
├── _site
├── _targets
├── _targets.R
├── _variables.yml
├── avhrr
├── build
├── code
├── course_notes.qmd
├── data
├── data-raw
├── data_wrangling.Rproj
├── deploy.sh
├── extension_list.txt
├── fonts
├── index.html
├── index.qmd
├── pdf_slides
├── scratch.html
├── scratch.qmd
├── seas
├── site_libs
├── slides
└── tests</code></pre>
</div>
</div>
<ul>
<li>I want to load files from the <code>data</code> folder, but I also want <em>you</em> to be able to load them. I’m writing this from somewhere deep in the <code>slides</code> folder, but you won’t be there. Also, I’m on a Mac, but you may not be.</li>
</ul>
</section>
<section id="wheres-the-data-using-here-4" class="slide level2">
<h2>Where’s the data? Using <span class="fg-green">here()</span></h2>
<p>So:</p>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb7" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a aria-hidden="true" tabindex="-1"></a><span class="do">## Load the file relative to the path from the top of the project, without separators, etc</span></span>
<span id="cb7-2"><a aria-hidden="true" tabindex="-1"></a>organs <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="at">file =</span> <span class="fu">here</span>(<span class="st">"data"</span>, <span class="st">"organdonation.csv"</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb8" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a aria-hidden="true" tabindex="-1"></a>organs</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre data-code-line-numbers=""><code># A tibble: 238 × 21
   country  year donors   pop pop.dens   gdp gdp.lag health health.lag pubhealth
   &lt;chr&gt;   &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt;  &lt;dbl&gt;      &lt;dbl&gt;     &lt;dbl&gt;
 1 Austra…    NA  NA    17065    0.220 16774   16591   1300       1224       4.8
 2 Austra…  1991  12.1  17284    0.223 17171   16774   1379       1300       5.4
 3 Austra…  1992  12.4  17495    0.226 17914   17171   1455       1379       5.4
 4 Austra…  1993  12.5  17667    0.228 18883   17914   1540       1455       5.4
 5 Austra…  1994  10.2  17855    0.231 19849   18883   1626       1540       5.4
 6 Austra…  1995  10.2  18072    0.233 21079   19849   1737       1626       5.5
 7 Austra…  1996  10.6  18311    0.237 21923   21079   1846       1737       5.6
 8 Austra…  1997  10.3  18518    0.239 22961   21923   1948       1846       5.7
 9 Austra…  1998  10.5  18711    0.242 24148   22961   2077       1948       5.9
10 Austra…  1999   8.67 18926    0.244 25445   24148   2231       2077       6.1
# ℹ 228 more rows
# ℹ 11 more variables: roads &lt;dbl&gt;, cerebvas &lt;dbl&gt;, assault &lt;dbl&gt;,
#   external &lt;dbl&gt;, txp.pop &lt;dbl&gt;, world &lt;chr&gt;, opt &lt;chr&gt;, consent.law &lt;chr&gt;,
#   consent.practice &lt;chr&gt;, consistent &lt;chr&gt;, ccode &lt;chr&gt;</code></pre>
</div>
</div>
</section>
<section id="read_csv-comes-in-different-varieties" class="slide level2">
<h2><code>read_csv()</code> comes in different varieties</h2>
<ul>
<li><code>read_csv()</code> Field separator is a comma: <span class="fg-red">,</span></li>
</ul>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb10" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a aria-hidden="true" tabindex="-1"></a>organs <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="at">file =</span> <span class="fu">here</span>(<span class="st">"data"</span>, <span class="st">"organdonation.csv"</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<ul>
<li><code>read_csv2()</code> Field separator is a semicolon: <span class="fg-red">;</span></li>
</ul>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb11" data-code-line-numbers=""><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a aria-hidden="true" tabindex="-1"></a><span class="co"># Example only</span></span>
<span id="cb11-2"><a aria-hidden="true" tabindex="-1"></a>my_data <span class="ot">&lt;-</span> <span class="fu">read_csv2</span>(<span class="at">file =</span> <span class="fu">here</span>(<span class="st">"data"</span>, <span class="st">"my_euro_file.csv))</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<ul>
<li>Both are special cases of <span class="fg-green"><strong><code>read_delim()</code></strong></span></li>
</ul>
</section>
<section id="other-species-are-also-catered-to" class="slide level2">
<h2>Other species are also catered to</h2>
<ul>
<li><code>read_tsv()</code> Tab separated.</li>
<li><code>read_fwf()</code> Fixed-width files.</li>
<li><code>read_log()</code> Log files (i.e.&nbsp;computer log files).</li>
<li><code>read_lines()</code> Just read in lines, without trying to parse them.</li>
<li><code>read_table()</code> Data that’s separated by one (or more) columns of space.</li>
</ul>
</section>
<section id="you-can-read-files-remotely-too" class="slide level2">
<h2>You can read files remotely, too</h2>
<ul>
<li>You can give all of these functions local files, or they can point to URLs.</li>
<li>Compressed files will be automatically uncompressed.</li>
<li>(Be careful what you download from remote locations!)</li>
</ul>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb12" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a aria-hidden="true" tabindex="-1"></a>organ_remote <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"http://kjhealy.co/organdonation.csv"</span>)</span>
<span id="cb12-2"><a aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-3"><a aria-hidden="true" tabindex="-1"></a>organ_remote</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre data-code-line-numbers=""><code># A tibble: 238 × 21
   country  year donors   pop pop.dens   gdp gdp.lag health health.lag pubhealth
   &lt;chr&gt;   &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt;  &lt;dbl&gt;      &lt;dbl&gt;     &lt;dbl&gt;
 1 Austra…    NA  NA    17065    0.220 16774   16591   1300       1224       4.8
 2 Austra…  1991  12.1  17284    0.223 17171   16774   1379       1300       5.4
 3 Austra…  1992  12.4  17495    0.226 17914   17171   1455       1379       5.4
 4 Austra…  1993  12.5  17667    0.228 18883   17914   1540       1455       5.4
 5 Austra…  1994  10.2  17855    0.231 19849   18883   1626       1540       5.4
 6 Austra…  1995  10.2  18072    0.233 21079   19849   1737       1626       5.5
 7 Austra…  1996  10.6  18311    0.237 21923   21079   1846       1737       5.6
 8 Austra…  1997  10.3  18518    0.239 22961   21923   1948       1846       5.7
 9 Austra…  1998  10.5  18711    0.242 24148   22961   2077       1948       5.9
10 Austra…  1999   8.67 18926    0.244 25445   24148   2231       2077       6.1
# ℹ 228 more rows
# ℹ 11 more variables: roads &lt;dbl&gt;, cerebvas &lt;dbl&gt;, assault &lt;dbl&gt;,
#   external &lt;dbl&gt;, txp.pop &lt;dbl&gt;, world &lt;chr&gt;, opt &lt;chr&gt;, consent.law &lt;chr&gt;,
#   consent.practice &lt;chr&gt;, consistent &lt;chr&gt;, ccode &lt;chr&gt;</code></pre>
</div>
</div>
</section>
<section id="an-example-read_table" class="slide level2">
<h2>An example: <code>read_table()</code></h2>
<div class="columns">
<div class="column" style="width:40%;">
<p><img data-src="img/mortality_top.png"> <br></p>
<p><img data-src="img/mortality_bottom.png"></p>
</div><div class="column right" style="width:60%;">

</div></div>
</section>
<section id="an-example-read_table-1" class="slide level2">
<h2>An example: <code>read_table()</code></h2>
<div class="columns">
<div class="column" style="width:40%;">
<p><img data-src="img/mortality_top.png"> <br></p>
<p><img data-src="img/mortality_bottom.png"></p>
</div><div class="column right" style="width:60%;">
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb14" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a aria-hidden="true" tabindex="-1"></a>engmort <span class="ot">&lt;-</span> <span class="fu">read_table</span>(<span class="fu">here</span>(<span class="st">"data"</span>, <span class="st">"mortality.txt"</span>), </span>
<span id="cb14-2"><a aria-hidden="true" tabindex="-1"></a>                      <span class="at">skip =</span> <span class="dv">2</span>, <span class="at">na =</span> <span class="st">"."</span>)</span>
<span id="cb14-3"><a aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-4"><a aria-hidden="true" tabindex="-1"></a>engmort</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre data-code-line-numbers=""><code># A tibble: 222 × 5
    Year Age    Female    Male   Total
   &lt;dbl&gt; &lt;chr&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;
 1  1841 0     0.136   0.169   0.153  
 2  1841 1     0.0596  0.0632  0.0614 
 3  1841 2     0.0364  0.0370  0.0367 
 4  1841 3     0.0249  0.0261  0.0255 
 5  1841 4     0.0185  0.0191  0.0188 
 6  1841 5     0.0140  0.0143  0.0141 
 7  1841 6     0.0109  0.0112  0.0110 
 8  1841 7     0.00859 0.00898 0.00879
 9  1841 8     0.00686 0.00725 0.00705
10  1841 9     0.00577 0.00605 0.00591
# ℹ 212 more rows</code></pre>
</div>
</div>
</div></div>
</section>
<section id="attend-to-the-column-specification" class="slide level2">
<h2>Attend to the <span class="fg-yellow">column specification</span></h2>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb16" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a aria-hidden="true" tabindex="-1"></a>engmort <span class="ot">&lt;-</span> <span class="fu">read_table</span>(<span class="fu">here</span>(<span class="st">"data"</span>, <span class="st">"mortality.txt"</span>), </span>
<span id="cb16-2"><a aria-hidden="true" tabindex="-1"></a>                      <span class="at">skip =</span> <span class="dv">2</span>, <span class="at">na =</span> <span class="st">"."</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stderr">
<pre data-code-line-numbers=""><code>
── Column specification ────────────────────────────────────────────────────────
cols(
  Year = col_double(),
  Age = col_character(),
  Female = col_double(),
  Male = col_double(),
  Total = col_double()
)</code></pre>
</div>
</div>
<ul>
<li class="fragment">The column specification tells you what the read function did. That is, how it interpreted each of the columns. It will also report if things don’t go as expected.</li>
<li class="fragment">Why is <code>age</code> imported in <code>character</code> format?</li>
</ul>
</section>
<section id="attend-to-the-column-specification-1" class="slide level2">
<h2>Attend to the <span class="fg-yellow">column specification</span></h2>
<ul>
<li>Absent you giving them a column specification, the <code>read_</code> functions try to <em>guess</em> what the type of each column is. They do this by looking at the first thousand rows of each column. They may guess incorrectly!</li>
</ul>
</section>
<section id="normalizing-names-and-recoding" class="slide level2">
<h2>Normalizing names and recoding</h2>
<div class="columns">
<div class="column" style="width:60%;">
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb18" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a aria-hidden="true" tabindex="-1"></a><span class="fu">read_table</span>(<span class="fu">here</span>(<span class="st">"data"</span>, <span class="st">"mortality.txt"</span>),</span>
<span id="cb18-2"><a aria-hidden="true" tabindex="-1"></a>           <span class="at">skip =</span> <span class="dv">2</span>, <span class="at">na =</span> <span class="st">"."</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</div><div class="column" style="width:40%;">
<div class="cell" data-layout-align="center">
<div class="cell-output cell-output-stdout">
<pre data-code-line-numbers=""><code># A tibble: 222 × 5
    Year Age    Female    Male   Total
   &lt;dbl&gt; &lt;chr&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;
 1  1841 0     0.136   0.169   0.153  
 2  1841 1     0.0596  0.0632  0.0614 
 3  1841 2     0.0364  0.0370  0.0367 
 4  1841 3     0.0249  0.0261  0.0255 
 5  1841 4     0.0185  0.0191  0.0188 
 6  1841 5     0.0140  0.0143  0.0141 
 7  1841 6     0.0109  0.0112  0.0110 
 8  1841 7     0.00859 0.00898 0.00879
 9  1841 8     0.00686 0.00725 0.00705
10  1841 9     0.00577 0.00605 0.00591
# ℹ 212 more rows</code></pre>
</div>
</div>
</div></div>
</section>
<section id="normalizing-names-and-recoding-1" class="slide level2">
<h2>Normalizing names and recoding</h2>
<div class="columns">
<div class="column" style="width:60%;">
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb20" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a aria-hidden="true" tabindex="-1"></a><span class="fu">read_table</span>(<span class="fu">here</span>(<span class="st">"data"</span>, <span class="st">"mortality.txt"</span>),</span>
<span id="cb20-2"><a aria-hidden="true" tabindex="-1"></a>           <span class="at">skip =</span> <span class="dv">2</span>, <span class="at">na =</span> <span class="st">"."</span>) <span class="sc">|&gt;</span></span>
<span id="cb20-3"><a aria-hidden="true" tabindex="-1"></a>  janitor<span class="sc">::</span><span class="fu">clean_names</span>()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</div><div class="column" style="width:40%;">
<div class="cell" data-layout-align="center">
<div class="cell-output cell-output-stdout">
<pre data-code-line-numbers=""><code># A tibble: 222 × 5
    year age    female    male   total
   &lt;dbl&gt; &lt;chr&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;
 1  1841 0     0.136   0.169   0.153  
 2  1841 1     0.0596  0.0632  0.0614 
 3  1841 2     0.0364  0.0370  0.0367 
 4  1841 3     0.0249  0.0261  0.0255 
 5  1841 4     0.0185  0.0191  0.0188 
 6  1841 5     0.0140  0.0143  0.0141 
 7  1841 6     0.0109  0.0112  0.0110 
 8  1841 7     0.00859 0.00898 0.00879
 9  1841 8     0.00686 0.00725 0.00705
10  1841 9     0.00577 0.00605 0.00591
# ℹ 212 more rows</code></pre>
</div>
</div>
</div></div>
</section>
<section id="normalizing-names-and-recoding-2" class="slide level2">
<h2>Normalizing names and recoding</h2>
<div class="columns">
<div class="column" style="width:60%;">
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb22" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a aria-hidden="true" tabindex="-1"></a><span class="fu">read_table</span>(<span class="fu">here</span>(<span class="st">"data"</span>, <span class="st">"mortality.txt"</span>),</span>
<span id="cb22-2"><a aria-hidden="true" tabindex="-1"></a>           <span class="at">skip =</span> <span class="dv">2</span>, <span class="at">na =</span> <span class="st">"."</span>) <span class="sc">|&gt;</span></span>
<span id="cb22-3"><a aria-hidden="true" tabindex="-1"></a>  janitor<span class="sc">::</span><span class="fu">clean_names</span>() <span class="sc">|&gt;</span></span>
<span id="cb22-4"><a aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">age  =</span> <span class="fu">case_match</span>(age,</span>
<span id="cb22-5"><a aria-hidden="true" tabindex="-1"></a>                           <span class="st">"110+"</span> <span class="sc">~</span> <span class="st">"110"</span>,</span>
<span id="cb22-6"><a aria-hidden="true" tabindex="-1"></a>                           <span class="at">.default =</span> age),</span>
<span id="cb22-7"><a aria-hidden="true" tabindex="-1"></a>         <span class="at">age =</span> <span class="fu">as.integer</span>(age))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</div><div class="column" style="width:40%;">
<div class="cell" data-layout-align="center">
<div class="cell-output cell-output-stdout">
<pre data-code-line-numbers=""><code># A tibble: 222 × 5
    year   age  female    male   total
   &lt;dbl&gt; &lt;int&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;
 1  1841     0 0.136   0.169   0.153  
 2  1841     1 0.0596  0.0632  0.0614 
 3  1841     2 0.0364  0.0370  0.0367 
 4  1841     3 0.0249  0.0261  0.0255 
 5  1841     4 0.0185  0.0191  0.0188 
 6  1841     5 0.0140  0.0143  0.0141 
 7  1841     6 0.0109  0.0112  0.0110 
 8  1841     7 0.00859 0.00898 0.00879
 9  1841     8 0.00686 0.00725 0.00705
10  1841     9 0.00577 0.00605 0.00591
# ℹ 212 more rows</code></pre>
</div>
</div>
</div></div>
</section>
<section id="janitor" class="slide level2">
<h2>Janitor</h2>
<ul>
<li>The <code>janitor</code> package is very handy!</li>
<li>The main cost of normalizing names comes with, e.g., data where there is a codebook you need to consult. But in general it’s worth it.</li>
</ul>
</section></section>
<section>
<section id="example-colspecs" class="title-slide slide level1 inv-title center" data-background-color="#252F3E">
<h1>Example: Colspecs</h1>

</section>
<section id="more-on-column-specifications" class="slide level2">
<h2>More on column specifications</h2>
<ul>
<li>CDC/NCHS data: <a href="https://data.cdc.gov/NCHS/Provisional-COVID-19-Death-Counts-by-Sex-Age-and-S/9bhg-hcku">Provisional COVID-19 Death Counts by Sex, Age, and State</a></li>
</ul>

<img data-src="img/cdc_nchs_sas.png" class="r-stretch"></section>
<section id="more-on-column-specifications-1" class="slide level2">
<h2>More on column specifications</h2>

<img data-src="img/cdc_nchs_sas_desc.png" class="r-stretch"></section>
<section id="lets-try-to-load-it" class="slide level2">
<h2>Let’s try to load it</h2>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb24" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a aria-hidden="true" tabindex="-1"></a>nchs <span class="ot">&lt;-</span> <span class="fu">with_edition</span>(<span class="dv">1</span>, <span class="fu">read_csv</span>(<span class="fu">here</span>(<span class="st">"data"</span>, <span class="st">"SAS_on_2021-04-13.csv"</span>)))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stderr">
<pre data-code-line-numbers=""><code>
── Column specification ────────────────────────────────────────────────────────
cols(
  `Data As Of` = col_character(),
  `Start Date` = col_character(),
  `End Date` = col_character(),
  Group = col_character(),
  Year = col_logical(),
  Month = col_logical(),
  State = col_character(),
  Sex = col_character(),
  `Age Group` = col_character(),
  `COVID-19 Deaths` = col_double(),
  `Total Deaths` = col_double(),
  `Pneumonia Deaths` = col_double(),
  `Pneumonia and COVID-19 Deaths` = col_double(),
  `Influenza Deaths` = col_double(),
  `Pneumonia, Influenza, or COVID-19 Deaths` = col_double(),
  Footnote = col_character()
)</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre data-code-line-numbers=""><code>Warning: 88128 parsing failures.
 row  col           expected actual                                                                         file
2755 Year 1/0/T/F/TRUE/FALSE   2020 '/Users/kjhealy/Documents/courses/data_wrangling/data/SAS_on_2021-04-13.csv'
2756 Year 1/0/T/F/TRUE/FALSE   2020 '/Users/kjhealy/Documents/courses/data_wrangling/data/SAS_on_2021-04-13.csv'
2757 Year 1/0/T/F/TRUE/FALSE   2020 '/Users/kjhealy/Documents/courses/data_wrangling/data/SAS_on_2021-04-13.csv'
2758 Year 1/0/T/F/TRUE/FALSE   2020 '/Users/kjhealy/Documents/courses/data_wrangling/data/SAS_on_2021-04-13.csv'
2759 Year 1/0/T/F/TRUE/FALSE   2020 '/Users/kjhealy/Documents/courses/data_wrangling/data/SAS_on_2021-04-13.csv'
.... .... .................. ...... ............................................................................
See problems(...) for more details.</code></pre>
</div>
</div>
</section>
<section id="lets-try-to-load-it-1" class="slide level2">
<h2>Let’s try to load it</h2>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb27" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a aria-hidden="true" tabindex="-1"></a><span class="fu">problems</span>(nchs)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre data-code-line-numbers=""><code># A tibble: 88,128 × 5
     row col   expected           actual file                                   
   &lt;int&gt; &lt;chr&gt; &lt;chr&gt;              &lt;chr&gt;  &lt;chr&gt;                                  
 1  2755 Year  1/0/T/F/TRUE/FALSE 2020   '/Users/kjhealy/Documents/courses/data…
 2  2756 Year  1/0/T/F/TRUE/FALSE 2020   '/Users/kjhealy/Documents/courses/data…
 3  2757 Year  1/0/T/F/TRUE/FALSE 2020   '/Users/kjhealy/Documents/courses/data…
 4  2758 Year  1/0/T/F/TRUE/FALSE 2020   '/Users/kjhealy/Documents/courses/data…
 5  2759 Year  1/0/T/F/TRUE/FALSE 2020   '/Users/kjhealy/Documents/courses/data…
 6  2760 Year  1/0/T/F/TRUE/FALSE 2020   '/Users/kjhealy/Documents/courses/data…
 7  2761 Year  1/0/T/F/TRUE/FALSE 2020   '/Users/kjhealy/Documents/courses/data…
 8  2762 Year  1/0/T/F/TRUE/FALSE 2020   '/Users/kjhealy/Documents/courses/data…
 9  2763 Year  1/0/T/F/TRUE/FALSE 2020   '/Users/kjhealy/Documents/courses/data…
10  2764 Year  1/0/T/F/TRUE/FALSE 2020   '/Users/kjhealy/Documents/courses/data…
# ℹ 88,118 more rows</code></pre>
</div>
</div>
</section>
<section id="lets-try-to-load-it-2" class="slide level2">
<h2>Let’s try to load it</h2>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb29" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a aria-hidden="true" tabindex="-1"></a><span class="fu">problems</span>(nchs)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre data-code-line-numbers=""><code># A tibble: 88,128 × 5
     row col   expected           actual file                                   
   &lt;int&gt; &lt;chr&gt; &lt;chr&gt;              &lt;chr&gt;  &lt;chr&gt;                                  
 1  2755 Year  1/0/T/F/TRUE/FALSE 2020   '/Users/kjhealy/Documents/courses/data…
 2  2756 Year  1/0/T/F/TRUE/FALSE 2020   '/Users/kjhealy/Documents/courses/data…
 3  2757 Year  1/0/T/F/TRUE/FALSE 2020   '/Users/kjhealy/Documents/courses/data…
 4  2758 Year  1/0/T/F/TRUE/FALSE 2020   '/Users/kjhealy/Documents/courses/data…
 5  2759 Year  1/0/T/F/TRUE/FALSE 2020   '/Users/kjhealy/Documents/courses/data…
 6  2760 Year  1/0/T/F/TRUE/FALSE 2020   '/Users/kjhealy/Documents/courses/data…
 7  2761 Year  1/0/T/F/TRUE/FALSE 2020   '/Users/kjhealy/Documents/courses/data…
 8  2762 Year  1/0/T/F/TRUE/FALSE 2020   '/Users/kjhealy/Documents/courses/data…
 9  2763 Year  1/0/T/F/TRUE/FALSE 2020   '/Users/kjhealy/Documents/courses/data…
10  2764 Year  1/0/T/F/TRUE/FALSE 2020   '/Users/kjhealy/Documents/courses/data…
# ℹ 88,118 more rows</code></pre>
</div>
</div>
<ul>
<li>Problems are stored as an attribute of the <code>nchs</code> object, so we can revisit them.</li>
<li>Parsing failures tend to cascade. Our data only has 56k rows but we got 88k failures.</li>
</ul>
</section>
<section id="take-a-look-with-head" class="slide level2">
<h2>Take a look with <span class="fg-green"><code>head()</code></span></h2>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb31" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(nchs)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre data-code-line-numbers=""><code># A tibble: 6 × 16
  `Data As Of` `Start Date` `End Date` Group Year  Month State Sex   `Age Group`
  &lt;chr&gt;        &lt;chr&gt;        &lt;chr&gt;      &lt;chr&gt; &lt;lgl&gt; &lt;lgl&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;      
1 04/07/2021   01/01/2020   04/03/2021 By T… NA    NA    Unit… All … All Ages   
2 04/07/2021   01/01/2020   04/03/2021 By T… NA    NA    Unit… All … Under 1 ye…
3 04/07/2021   01/01/2020   04/03/2021 By T… NA    NA    Unit… All … 0-17 years 
4 04/07/2021   01/01/2020   04/03/2021 By T… NA    NA    Unit… All … 1-4 years  
5 04/07/2021   01/01/2020   04/03/2021 By T… NA    NA    Unit… All … 5-14 years 
6 04/07/2021   01/01/2020   04/03/2021 By T… NA    NA    Unit… All … 15-24 years
# ℹ 7 more variables: `COVID-19 Deaths` &lt;dbl&gt;, `Total Deaths` &lt;dbl&gt;,
#   `Pneumonia Deaths` &lt;dbl&gt;, `Pneumonia and COVID-19 Deaths` &lt;dbl&gt;,
#   `Influenza Deaths` &lt;dbl&gt;, `Pneumonia, Influenza, or COVID-19 Deaths` &lt;dbl&gt;,
#   Footnote &lt;chr&gt;</code></pre>
</div>
</div>
</section>
<section id="take-a-look-with-tail" class="slide level2">
<h2>Take a look with <span class="fg-green"><code>tail()</code></span></h2>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb33" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a aria-hidden="true" tabindex="-1"></a><span class="fu">tail</span>(nchs)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre data-code-line-numbers=""><code># A tibble: 6 × 16
  `Data As Of` `Start Date` `End Date` Group Year  Month State Sex   `Age Group`
  &lt;chr&gt;        &lt;chr&gt;        &lt;chr&gt;      &lt;chr&gt; &lt;lgl&gt; &lt;lgl&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;      
1 04/07/2021   04/01/2021   04/03/2021 By M… NA    NA    Puer… Fema… 45-54 years
2 04/07/2021   04/01/2021   04/03/2021 By M… NA    NA    Puer… Fema… 50-64 years
3 04/07/2021   04/01/2021   04/03/2021 By M… NA    NA    Puer… Fema… 55-64 years
4 04/07/2021   04/01/2021   04/03/2021 By M… NA    NA    Puer… Fema… 65-74 years
5 04/07/2021   04/01/2021   04/03/2021 By M… NA    NA    Puer… Fema… 75-84 years
6 04/07/2021   04/01/2021   04/03/2021 By M… NA    NA    Puer… Fema… 85 years a…
# ℹ 7 more variables: `COVID-19 Deaths` &lt;dbl&gt;, `Total Deaths` &lt;dbl&gt;,
#   `Pneumonia Deaths` &lt;dbl&gt;, `Pneumonia and COVID-19 Deaths` &lt;dbl&gt;,
#   `Influenza Deaths` &lt;dbl&gt;, `Pneumonia, Influenza, or COVID-19 Deaths` &lt;dbl&gt;,
#   Footnote &lt;chr&gt;</code></pre>
</div>
</div>
</section>
<section id="take-a-look-with-slice_sample" class="slide level2">
<h2>Take a look with <span class="fg-green"><code>slice_sample()</code></span></h2>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb35" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a aria-hidden="true" tabindex="-1"></a>nchs <span class="sc">|&gt;</span> </span>
<span id="cb35-2"><a aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_sample</span>(<span class="at">n =</span> <span class="dv">10</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre data-code-line-numbers=""><code># A tibble: 10 × 16
   `Data As Of` `Start Date` `End Date` Group    Year  Month State         Sex  
   &lt;chr&gt;        &lt;chr&gt;        &lt;chr&gt;      &lt;chr&gt;    &lt;lgl&gt; &lt;lgl&gt; &lt;chr&gt;         &lt;chr&gt;
 1 04/07/2021   04/01/2020   04/30/2020 By Month NA    NA    Virginia      Male 
 2 04/07/2021   01/01/2020   01/31/2020 By Month NA    TRUE  Oregon        Fema…
 3 04/07/2021   01/01/2020   01/31/2020 By Month NA    TRUE  South Caroli… Male 
 4 04/07/2021   09/01/2020   09/30/2020 By Month NA    NA    Pennsylvania  All …
 5 04/07/2021   01/01/2021   04/03/2021 By Year  NA    NA    Louisiana     Male 
 6 04/07/2021   01/01/2020   12/31/2020 By Year  NA    NA    North Caroli… All …
 7 04/07/2021   05/01/2020   05/31/2020 By Month NA    NA    Alabama       Male 
 8 04/07/2021   01/01/2021   04/03/2021 By Year  NA    NA    Massachusetts Fema…
 9 04/07/2021   04/01/2021   04/03/2021 By Month NA    NA    Connecticut   Fema…
10 04/07/2021   02/01/2020   02/29/2020 By Month NA    NA    Oregon        All …
# ℹ 8 more variables: `Age Group` &lt;chr&gt;, `COVID-19 Deaths` &lt;dbl&gt;,
#   `Total Deaths` &lt;dbl&gt;, `Pneumonia Deaths` &lt;dbl&gt;,
#   `Pneumonia and COVID-19 Deaths` &lt;dbl&gt;, `Influenza Deaths` &lt;dbl&gt;,
#   `Pneumonia, Influenza, or COVID-19 Deaths` &lt;dbl&gt;, Footnote &lt;chr&gt;</code></pre>
</div>
</div>
</section>
<section id="aside-one-that-happened-earlier" class="slide level2">
<h2>Aside: one that happened earlier …</h2>

<img data-src="img/slice_sample_why_lgl.png" class="r-stretch"></section>
<section id="take-a-look-with-slice" class="slide level2">
<h2>Take a look with <span class="fg-green"><code>slice()</code></span></h2>
<ul>
<li>Let’s look at the rows <span class="fg-green"><strong><code>read_csv()</code></strong></span> complained about.</li>
</ul>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb37" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a aria-hidden="true" tabindex="-1"></a>nchs <span class="sc">|&gt;</span> </span>
<span id="cb37-2"><a aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice</span>(<span class="dv">2750</span><span class="sc">:</span><span class="dv">2760</span>) </span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre data-code-line-numbers=""><code># A tibble: 11 × 16
   `Data As Of` `Start Date` `End Date` Group    Year  Month State         Sex  
   &lt;chr&gt;        &lt;chr&gt;        &lt;chr&gt;      &lt;chr&gt;    &lt;lgl&gt; &lt;lgl&gt; &lt;chr&gt;         &lt;chr&gt;
 1 04/07/2021   01/01/2020   04/03/2021 By Total NA    NA    Puerto Rico   Fema…
 2 04/07/2021   01/01/2020   04/03/2021 By Total NA    NA    Puerto Rico   Fema…
 3 04/07/2021   01/01/2020   04/03/2021 By Total NA    NA    Puerto Rico   Fema…
 4 04/07/2021   01/01/2020   04/03/2021 By Total NA    NA    Puerto Rico   Fema…
 5 04/07/2021   01/01/2020   04/03/2021 By Total NA    NA    Puerto Rico   Fema…
 6 04/07/2021   01/01/2020   12/31/2020 By Year  NA    NA    United States All …
 7 04/07/2021   01/01/2020   12/31/2020 By Year  NA    NA    United States All …
 8 04/07/2021   01/01/2020   12/31/2020 By Year  NA    NA    United States All …
 9 04/07/2021   01/01/2020   12/31/2020 By Year  NA    NA    United States All …
10 04/07/2021   01/01/2020   12/31/2020 By Year  NA    NA    United States All …
11 04/07/2021   01/01/2020   12/31/2020 By Year  NA    NA    United States All …
# ℹ 8 more variables: `Age Group` &lt;chr&gt;, `COVID-19 Deaths` &lt;dbl&gt;,
#   `Total Deaths` &lt;dbl&gt;, `Pneumonia Deaths` &lt;dbl&gt;,
#   `Pneumonia and COVID-19 Deaths` &lt;dbl&gt;, `Influenza Deaths` &lt;dbl&gt;,
#   `Pneumonia, Influenza, or COVID-19 Deaths` &lt;dbl&gt;, Footnote &lt;chr&gt;</code></pre>
</div>
</div>
</section>
<section id="take-a-look-with-slice-1" class="slide level2">
<h2>Take a look with <span class="fg-green"><code>slice()</code></span></h2>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb39" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a aria-hidden="true" tabindex="-1"></a>nchs <span class="sc">|&gt;</span> </span>
<span id="cb39-2"><a aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice</span>(<span class="dv">2750</span><span class="sc">:</span><span class="dv">2760</span>) <span class="sc">|&gt;</span> </span>
<span id="cb39-3"><a aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(Year, Month, State)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre data-code-line-numbers=""><code># A tibble: 11 × 3
   Year  Month State        
   &lt;lgl&gt; &lt;lgl&gt; &lt;chr&gt;        
 1 NA    NA    Puerto Rico  
 2 NA    NA    Puerto Rico  
 3 NA    NA    Puerto Rico  
 4 NA    NA    Puerto Rico  
 5 NA    NA    Puerto Rico  
 6 NA    NA    United States
 7 NA    NA    United States
 8 NA    NA    United States
 9 NA    NA    United States
10 NA    NA    United States
11 NA    NA    United States</code></pre>
</div>
</div>
<ul>
<li>Hm, something to do with the transition to national numbers maybe?</li>
</ul>
</section>
<section id="take-a-look-with-select-filter" class="slide level2">
<h2>Take a look with <span class="fg-green"><code>select()</code></span> &amp; <span class="fg-green"><code>filter()</code></span></h2>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb41" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a aria-hidden="true" tabindex="-1"></a>nchs <span class="sc">|&gt;</span> </span>
<span id="cb41-2"><a aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(Year, Month, State) <span class="sc">|&gt;</span> </span>
<span id="cb41-3"><a aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(State <span class="sc">==</span> <span class="st">"New York"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre data-code-line-numbers=""><code># A tibble: 969 × 3
   Year  Month State   
   &lt;lgl&gt; &lt;lgl&gt; &lt;chr&gt;   
 1 NA    NA    New York
 2 NA    NA    New York
 3 NA    NA    New York
 4 NA    NA    New York
 5 NA    NA    New York
 6 NA    NA    New York
 7 NA    NA    New York
 8 NA    NA    New York
 9 NA    NA    New York
10 NA    NA    New York
# ℹ 959 more rows</code></pre>
</div>
</div>
</section>
<section id="take-a-look-with-is.na" class="slide level2">
<h2>Take a look with <span class="fg-green"><code>is.na()</code></span></h2>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb43" data-source-line-numbers="nil" data-code-line-numbers="3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a aria-hidden="true" tabindex="-1"></a>nchs <span class="sc">|&gt;</span> </span>
<span id="cb43-2"><a aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(Year, Month, State) <span class="sc">|&gt;</span> </span>
<span id="cb43-3"><a aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(Year)) </span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre data-code-line-numbers=""><code># A tibble: 0 × 3
# ℹ 3 variables: Year &lt;lgl&gt;, Month &lt;lgl&gt;, State &lt;chr&gt;</code></pre>
</div>
</div>
<ul>
<li>It really has been read in as a completely empty column.</li>
<li>That doesn’t seem like it can be right.</li>
</ul>
</section>
<section id="take-a-look-with-distinct" class="slide level2">
<h2>Take a look with <span class="fg-green"><code>distinct()</code></span></h2>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb45" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a aria-hidden="true" tabindex="-1"></a>nchs <span class="sc">|&gt;</span> </span>
<span id="cb45-2"><a aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(Year) <span class="sc">|&gt;</span> </span>
<span id="cb45-3"><a aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(Year)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre data-code-line-numbers=""><code># A tibble: 1 × 1
  Year 
  &lt;lgl&gt;
1 NA   </code></pre>
</div>
</div>
<ul>
<li>Again, it’s been read in as a completely empty column.</li>
</ul>
</section>
<section id="take-a-look-with-read_lines" class="slide level2">
<h2>Take a look with <span class="fg-green"><code>read_lines()</code></span></h2>
<ul>
<li>Time to reach for a different kitchen knife.</li>
</ul>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb47" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a aria-hidden="true" tabindex="-1"></a><span class="fu">read_lines</span>(<span class="fu">here</span>(<span class="st">"data"</span>, <span class="st">"SAS_on_2021-04-13.csv"</span>), <span class="at">n_max =</span> <span class="dv">10</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre data-code-line-numbers=""><code> [1] "Data As Of,Start Date,End Date,Group,Year,Month,State,Sex,Age Group,COVID-19 Deaths,Total Deaths,Pneumonia Deaths,Pneumonia and COVID-19 Deaths,Influenza Deaths,\"Pneumonia, Influenza, or COVID-19 Deaths\",Footnote"
 [2] "04/07/2021,01/01/2020,04/03/2021,By Total,,,United States,All Sexes,All Ages,539723,4161167,466437,263147,9037,750804,"                                                                                                
 [3] "04/07/2021,01/01/2020,04/03/2021,By Total,,,United States,All Sexes,Under 1 year,59,22626,246,10,21,316,"                                                                                                              
 [4] "04/07/2021,01/01/2020,04/03/2021,By Total,,,United States,All Sexes,0-17 years,251,39620,667,46,179,1051,"                                                                                                             
 [5] "04/07/2021,01/01/2020,04/03/2021,By Total,,,United States,All Sexes,1-4 years,31,4069,137,5,61,224,"                                                                                                                   
 [6] "04/07/2021,01/01/2020,04/03/2021,By Total,,,United States,All Sexes,5-14 years,89,6578,195,19,76,341,"                                                                                                                 
 [7] "04/07/2021,01/01/2020,04/03/2021,By Total,,,United States,All Sexes,15-24 years,804,42596,930,317,81,1493,"                                                                                                            
 [8] "04/07/2021,01/01/2020,04/03/2021,By Total,,,United States,All Sexes,18-29 years,1996,75339,2184,884,150,3434,"                                                                                                         
 [9] "04/07/2021,01/01/2020,04/03/2021,By Total,,,United States,All Sexes,25-34 years,3543,88196,3493,1617,237,5638,"                                                                                                        
[10] "04/07/2021,01/01/2020,04/03/2021,By Total,,,United States,All Sexes,30-39 years,5792,107348,5276,2658,318,8706,"                                                                                                       </code></pre>
</div>
</div>
</section>
<section id="we-can-get-the-whole-thing-this-way" class="slide level2">
<h2>We can get the whole thing this way</h2>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb49" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a aria-hidden="true" tabindex="-1"></a>raw_file <span class="ot">&lt;-</span> <span class="fu">read_lines</span>(<span class="fu">here</span>(<span class="st">"data"</span>, <span class="st">"SAS_on_2021-04-13.csv"</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<ul>
<li>This imports the data as a long, long character vector, with each element being a line.</li>
</ul>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb50" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a aria-hidden="true" tabindex="-1"></a><span class="co"># reminder: indexing 1D vectors</span></span>
<span id="cb50-2"><a aria-hidden="true" tabindex="-1"></a>letters[<span class="dv">5</span><span class="sc">:</span><span class="dv">6</span>]</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre data-code-line-numbers=""><code>[1] "e" "f"</code></pre>
</div>
</div>
</section>
<section id="now-were-just-looking-at-lines-in-a-file" class="slide level2">
<h2>Now we’re just looking at lines in a file</h2>
<div class="smallcode">
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb52" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a aria-hidden="true" tabindex="-1"></a><span class="co"># This is not a tibble; we have to index it the basic way</span></span>
<span id="cb52-2"><a aria-hidden="true" tabindex="-1"></a>raw_file[<span class="dv">2753</span><span class="sc">:</span><span class="dv">2758</span>] </span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre data-code-line-numbers=""><code>[1] "04/07/2021,01/01/2020,04/03/2021,By Total,,,Puerto Rico,Female,65-74 years,203,2650,410,151,,466,One or more data cells have counts between 1-9 and have been suppressed in accordance with NCHS confidentiality standards."
[2] "04/07/2021,01/01/2020,04/03/2021,By Total,,,Puerto Rico,Female,75-84 years,234,4274,656,154,16,751,"                                                                                                                        
[3] "04/07/2021,01/01/2020,04/03/2021,By Total,,,Puerto Rico,Female,85 years and over,222,6164,795,136,29,909,"                                                                                                                  
[4] "04/07/2021,01/01/2020,12/31/2020,By Year,2020,,United States,All Sexes,All Ages,380949,3372967,349667,178222,8779,560025,"                                                                                                  
[5] "04/07/2021,01/01/2020,12/31/2020,By Year,2020,,United States,All Sexes,Under 1 year,48,19356,224,9,21,284,"                                                                                                                 
[6] "04/07/2021,01/01/2020,12/31/2020,By Year,2020,,United States,All Sexes,0-17 years,189,33808,598,35,178,930,"                                                                                                                </code></pre>
</div>
</div>
</div>
<div class="fragment" data-fragment-index="1">
<p><em>There</em> you are, you bastard.</p>
</div>
<div class="fragment" data-fragment-index="2">
<p>In this case, this is due to the kind of data this is, mixing multiple reporting levels and totals. That is, it’s not a mistake in the <em>data</em>, but rather in the <em>parsing</em>.</p>
</div>
</section>
<section id="ok-lets-go-back-to-the-colspec" class="slide level2">
<h2>OK, let’s go back to the colspec!</h2>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb54" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a aria-hidden="true" tabindex="-1"></a>nchs <span class="ot">&lt;-</span> <span class="fu">with_edition</span>(<span class="dv">1</span>, <span class="fu">read_csv</span>(<span class="fu">here</span>(<span class="st">"data"</span>, <span class="st">"SAS_on_2021-04-13.csv"</span>))) </span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stderr">
<pre data-code-line-numbers=""><code>
── Column specification ────────────────────────────────────────────────────────
cols(
  `Data As Of` = col_character(),
  `Start Date` = col_character(),
  `End Date` = col_character(),
  Group = col_character(),
  Year = col_logical(),
  Month = col_logical(),
  State = col_character(),
  Sex = col_character(),
  `Age Group` = col_character(),
  `COVID-19 Deaths` = col_double(),
  `Total Deaths` = col_double(),
  `Pneumonia Deaths` = col_double(),
  `Pneumonia and COVID-19 Deaths` = col_double(),
  `Influenza Deaths` = col_double(),
  `Pneumonia, Influenza, or COVID-19 Deaths` = col_double(),
  Footnote = col_character()
)</code></pre>
</div>
</div>
<ul>
<li>We can just copy it from the console output! It’s valid code.</li>
</ul>
</section>
<section id="we-use-it-with-col_types" class="slide level2">
<h2>We use it with <span class="fg-yellow">col_types</span></h2>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb56" data-code-line-numbers=""><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a aria-hidden="true" tabindex="-1"></a>nchs <span class="ot">&lt;-</span> <span class="fu">with_edition</span>(<span class="dv">1</span>, <span class="fu">read_csv</span>(<span class="fu">here</span>(<span class="st">"data"</span>, <span class="st">"SAS_on_2021-04-13.csv"</span>), </span>
<span id="cb56-2"><a aria-hidden="true" tabindex="-1"></a>           <span class="at">col_types =</span> <span class="fu">cols</span>(</span>
<span id="cb56-3"><a aria-hidden="true" tabindex="-1"></a>  <span class="st">`</span><span class="at">Data As Of</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">col_character</span>(),</span>
<span id="cb56-4"><a aria-hidden="true" tabindex="-1"></a>  <span class="st">`</span><span class="at">Start Date</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">col_character</span>(),</span>
<span id="cb56-5"><a aria-hidden="true" tabindex="-1"></a>  <span class="st">`</span><span class="at">End Date</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">col_character</span>(),</span>
<span id="cb56-6"><a aria-hidden="true" tabindex="-1"></a>  <span class="at">Group =</span> <span class="fu">col_character</span>(),</span>
<span id="cb56-7"><a aria-hidden="true" tabindex="-1"></a>  <span class="at">Year =</span> <span class="fu">col_logical</span>(),</span>
<span id="cb56-8"><a aria-hidden="true" tabindex="-1"></a>  <span class="at">Month =</span> <span class="fu">col_logical</span>(),</span>
<span id="cb56-9"><a aria-hidden="true" tabindex="-1"></a>  <span class="at">State =</span> <span class="fu">col_character</span>(),</span>
<span id="cb56-10"><a aria-hidden="true" tabindex="-1"></a>  <span class="at">Sex =</span> <span class="fu">col_character</span>(),</span>
<span id="cb56-11"><a aria-hidden="true" tabindex="-1"></a>  <span class="st">`</span><span class="at">Age Group</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">col_character</span>(),</span>
<span id="cb56-12"><a aria-hidden="true" tabindex="-1"></a>  <span class="st">`</span><span class="at">COVID-19 Deaths</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">col_double</span>(),</span>
<span id="cb56-13"><a aria-hidden="true" tabindex="-1"></a>  <span class="st">`</span><span class="at">Total Deaths</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">col_double</span>(),</span>
<span id="cb56-14"><a aria-hidden="true" tabindex="-1"></a>  <span class="st">`</span><span class="at">Pneumonia Deaths</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">col_double</span>(),</span>
<span id="cb56-15"><a aria-hidden="true" tabindex="-1"></a>  <span class="st">`</span><span class="at">Pneumonia and COVID-19 Deaths</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">col_double</span>(),</span>
<span id="cb56-16"><a aria-hidden="true" tabindex="-1"></a>  <span class="st">`</span><span class="at">Influenza Deaths</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">col_double</span>(),</span>
<span id="cb56-17"><a aria-hidden="true" tabindex="-1"></a>  <span class="st">`</span><span class="at">Pneumonia, Influenza, or COVID-19 Deaths</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">col_double</span>(),</span>
<span id="cb56-18"><a aria-hidden="true" tabindex="-1"></a>  <span class="at">Footnote =</span> <span class="fu">col_character</span>()</span>
<span id="cb56-19"><a aria-hidden="true" tabindex="-1"></a>)))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<ul>
<li>But we know we need to make some adjustments.</li>
</ul>
</section>
<section id="fixes" class="slide level2">
<h2>Fixes</h2>
<div class="smallcode">
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb57" data-source-line-numbers="nil" data-code-line-numbers="2,7,8,9,11,12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a aria-hidden="true" tabindex="-1"></a><span class="co"># Date format</span></span>
<span id="cb57-2"><a aria-hidden="true" tabindex="-1"></a>us_style <span class="ot">&lt;-</span>  <span class="st">"%m/%d/%Y"</span> </span>
<span id="cb57-3"><a aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-4"><a aria-hidden="true" tabindex="-1"></a>nchs <span class="ot">&lt;-</span> <span class="fu">with_edition</span>(<span class="dv">1</span>, <span class="fu">read_csv</span>(</span>
<span id="cb57-5"><a aria-hidden="true" tabindex="-1"></a>  <span class="fu">here</span>(<span class="st">"data"</span>, <span class="st">"SAS_on_2021-04-13.csv"</span>),</span>
<span id="cb57-6"><a aria-hidden="true" tabindex="-1"></a>  <span class="at">col_types =</span> <span class="fu">cols</span>(</span>
<span id="cb57-7"><a aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">Data As Of</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">col_date</span>(<span class="at">format =</span> us_style),</span>
<span id="cb57-8"><a aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">Start Date</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">col_date</span>(<span class="at">format =</span> us_style),</span>
<span id="cb57-9"><a aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">End Date</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">col_date</span>(<span class="at">format =</span> us_style),</span>
<span id="cb57-10"><a aria-hidden="true" tabindex="-1"></a>    <span class="at">Group =</span> <span class="fu">col_character</span>(),</span>
<span id="cb57-11"><a aria-hidden="true" tabindex="-1"></a>    <span class="at">Year =</span> <span class="fu">col_character</span>(),</span>
<span id="cb57-12"><a aria-hidden="true" tabindex="-1"></a>    <span class="at">Month =</span> <span class="fu">col_character</span>(),</span>
<span id="cb57-13"><a aria-hidden="true" tabindex="-1"></a>    <span class="at">State =</span> <span class="fu">col_character</span>(),</span>
<span id="cb57-14"><a aria-hidden="true" tabindex="-1"></a>    <span class="at">Sex =</span> <span class="fu">col_character</span>(),</span>
<span id="cb57-15"><a aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">Age Group</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">col_character</span>(),</span>
<span id="cb57-16"><a aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">COVID-19 Deaths</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">col_integer</span>(),</span>
<span id="cb57-17"><a aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">Total Deaths</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">col_integer</span>(),</span>
<span id="cb57-18"><a aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">Pneumonia Deaths</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">col_integer</span>(),</span>
<span id="cb57-19"><a aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">Pneumonia and COVID-19 Deaths</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">col_integer</span>(),</span>
<span id="cb57-20"><a aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">Influenza Deaths</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">col_integer</span>(),</span>
<span id="cb57-21"><a aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">Pneumonia, Influenza, or COVID-19 Deaths</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">col_integer</span>(),</span>
<span id="cb57-22"><a aria-hidden="true" tabindex="-1"></a>    <span class="at">Footnote =</span> <span class="fu">col_character</span>()</span>
<span id="cb57-23"><a aria-hidden="true" tabindex="-1"></a>  )) <span class="sc">|&gt;</span> </span>
<span id="cb57-24"><a aria-hidden="true" tabindex="-1"></a>  janitor<span class="sc">::</span><span class="fu">clean_names</span>() <span class="sc">|&gt;</span> </span>
<span id="cb57-25"><a aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>footnote) <span class="sc">|&gt;</span></span>
<span id="cb57-26"><a aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">age_group =</span> <span class="fu">str_to_sentence</span>(age_group)) <span class="sc">|&gt;</span></span>
<span id="cb57-27"><a aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">str_detect</span>(state, <span class="st">"Total"</span>))</span>
<span id="cb57-28"><a aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</div>
</section>
<section id="now-lets-look-again" class="slide level2">
<h2>Now let’s look again</h2>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb58" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(nchs)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre data-code-line-numbers=""><code>[1] 52326    15</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb60" data-source-line-numbers="nil" data-code-line-numbers="3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a aria-hidden="true" tabindex="-1"></a>nchs <span class="sc">|&gt;</span> </span>
<span id="cb60-2"><a aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(year, month, state) <span class="sc">|&gt;</span> </span>
<span id="cb60-3"><a aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(year)) </span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre data-code-line-numbers=""><code># A tibble: 49,572 × 3
   year  month state        
   &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;        
 1 2020  &lt;NA&gt;  United States
 2 2020  &lt;NA&gt;  United States
 3 2020  &lt;NA&gt;  United States
 4 2020  &lt;NA&gt;  United States
 5 2020  &lt;NA&gt;  United States
 6 2020  &lt;NA&gt;  United States
 7 2020  &lt;NA&gt;  United States
 8 2020  &lt;NA&gt;  United States
 9 2020  &lt;NA&gt;  United States
10 2020  &lt;NA&gt;  United States
# ℹ 49,562 more rows</code></pre>
</div>
</div>
</section>
<section id="now-lets-look-again-1" class="slide level2">
<h2>Now let’s look again</h2>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb62" data-source-line-numbers="nil" data-code-line-numbers="2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a aria-hidden="true" tabindex="-1"></a>nchs <span class="sc">|&gt;</span> </span>
<span id="cb62-2"><a aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(year) </span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre data-code-line-numbers=""><code># A tibble: 3 × 1
  year 
  &lt;chr&gt;
1 &lt;NA&gt; 
2 2020 
3 2021 </code></pre>
</div>
</div>
</section>
<section id="lessons-learned" class="slide level2">
<h2>Lessons learned</h2>
<ul>
<li class="fragment">I said at the start that it was no fun, but also weirdly satisfying.</li>
<li class="fragment">When <span class="fg-green"><strong><code>read_csv()</code></strong></span> warns you of a parsing failure, <strong>don’t ignore it</strong>.</li>
<li class="fragment"><span class="fg-green"><strong><code>read_lines()</code></strong></span> lets you get the file in a nearly unprocessed form.</li>
<li class="fragment">The <code>colspec</code> output is your friend.</li>
</ul>
</section>
<section id="if-we-wanted-to" class="slide level2">
<h2>If we wanted to …</h2>
<div class="columns smallcode">
<div class="column" style="width:50%;">
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb64" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(stringr)  <span class="co"># it's back!</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</div><div class="column" style="width:50%;">

</div></div>
</section>
<section id="if-we-wanted-to-1" class="slide level2">
<h2>If we wanted to …</h2>
<div class="columns smallcode">
<div class="column" style="width:50%;">
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb65" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(stringr)  <span class="co"># it's back!</span></span>
<span id="cb65-2"><a aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-3"><a aria-hidden="true" tabindex="-1"></a>nchs</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</div><div class="column" style="width:50%;">
<div class="cell" data-layout-align="center">
<div class="cell-output cell-output-stdout">
<pre data-code-line-numbers=""><code># A tibble: 52,326 × 15
   data_as_of start_date end_date   group    year  month state   sex   age_group
   &lt;date&gt;     &lt;date&gt;     &lt;date&gt;     &lt;chr&gt;    &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;   &lt;chr&gt; &lt;chr&gt;    
 1 2021-04-07 2020-01-01 2021-04-03 By Total &lt;NA&gt;  &lt;NA&gt;  United… All … All ages 
 2 2021-04-07 2020-01-01 2021-04-03 By Total &lt;NA&gt;  &lt;NA&gt;  United… All … Under 1 …
 3 2021-04-07 2020-01-01 2021-04-03 By Total &lt;NA&gt;  &lt;NA&gt;  United… All … 0-17 yea…
 4 2021-04-07 2020-01-01 2021-04-03 By Total &lt;NA&gt;  &lt;NA&gt;  United… All … 1-4 years
 5 2021-04-07 2020-01-01 2021-04-03 By Total &lt;NA&gt;  &lt;NA&gt;  United… All … 5-14 yea…
 6 2021-04-07 2020-01-01 2021-04-03 By Total &lt;NA&gt;  &lt;NA&gt;  United… All … 15-24 ye…
 7 2021-04-07 2020-01-01 2021-04-03 By Total &lt;NA&gt;  &lt;NA&gt;  United… All … 18-29 ye…
 8 2021-04-07 2020-01-01 2021-04-03 By Total &lt;NA&gt;  &lt;NA&gt;  United… All … 25-34 ye…
 9 2021-04-07 2020-01-01 2021-04-03 By Total &lt;NA&gt;  &lt;NA&gt;  United… All … 30-39 ye…
10 2021-04-07 2020-01-01 2021-04-03 By Total &lt;NA&gt;  &lt;NA&gt;  United… All … 35-44 ye…
# ℹ 52,316 more rows
# ℹ 6 more variables: covid_19_deaths &lt;int&gt;, total_deaths &lt;int&gt;,
#   pneumonia_deaths &lt;int&gt;, pneumonia_and_covid_19_deaths &lt;int&gt;,
#   influenza_deaths &lt;int&gt;, pneumonia_influenza_or_covid_19_deaths &lt;int&gt;</code></pre>
</div>
</div>
</div></div>
</section>
<section id="if-we-wanted-to-2" class="slide level2">
<h2>If we wanted to …</h2>
<div class="columns smallcode">
<div class="column" style="width:50%;">
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb67" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(stringr)  <span class="co"># it's back!</span></span>
<span id="cb67-2"><a aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-3"><a aria-hidden="true" tabindex="-1"></a>nchs <span class="sc">|&gt;</span></span>
<span id="cb67-4"><a aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">!</span>(<span class="fu">c</span>(data_as_of<span class="sc">:</span>end_date, year, month)))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</div><div class="column" style="width:50%;">
<div class="cell" data-layout-align="center">
<div class="cell-output cell-output-stdout">
<pre data-code-line-numbers=""><code># A tibble: 52,326 × 10
   group    state  sex   age_group covid_19_deaths total_deaths pneumonia_deaths
   &lt;chr&gt;    &lt;chr&gt;  &lt;chr&gt; &lt;chr&gt;               &lt;int&gt;        &lt;int&gt;            &lt;int&gt;
 1 By Total Unite… All … All ages           539723      4161167           466437
 2 By Total Unite… All … Under 1 …              59        22626              246
 3 By Total Unite… All … 0-17 yea…             251        39620              667
 4 By Total Unite… All … 1-4 years              31         4069              137
 5 By Total Unite… All … 5-14 yea…              89         6578              195
 6 By Total Unite… All … 15-24 ye…             804        42596              930
 7 By Total Unite… All … 18-29 ye…            1996        75339             2184
 8 By Total Unite… All … 25-34 ye…            3543        88196             3493
 9 By Total Unite… All … 30-39 ye…            5792       107348             5276
10 By Total Unite… All … 35-44 ye…            9259       126848             8203
# ℹ 52,316 more rows
# ℹ 3 more variables: pneumonia_and_covid_19_deaths &lt;int&gt;,
#   influenza_deaths &lt;int&gt;, pneumonia_influenza_or_covid_19_deaths &lt;int&gt;</code></pre>
</div>
</div>
</div></div>
</section>
<section id="if-we-wanted-to-3" class="slide level2">
<h2>If we wanted to …</h2>
<div class="columns smallcode">
<div class="column" style="width:50%;">
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb69" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb69-1"><a aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(stringr)  <span class="co"># it's back!</span></span>
<span id="cb69-2"><a aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-3"><a aria-hidden="true" tabindex="-1"></a>nchs <span class="sc">|&gt;</span></span>
<span id="cb69-4"><a aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">!</span>(<span class="fu">c</span>(data_as_of<span class="sc">:</span>end_date, year, month))) <span class="sc">|&gt;</span></span>
<span id="cb69-5"><a aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(covid_19_deaths<span class="sc">:</span>pneumonia_influenza_or_covid_19_deaths,</span>
<span id="cb69-6"><a aria-hidden="true" tabindex="-1"></a>               <span class="at">names_to =</span> <span class="st">"outcome"</span>,</span>
<span id="cb69-7"><a aria-hidden="true" tabindex="-1"></a>               <span class="at">values_to =</span> <span class="st">"n"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</div><div class="column" style="width:50%;">
<div class="cell" data-layout-align="center">
<div class="cell-output cell-output-stdout">
<pre data-code-line-numbers=""><code># A tibble: 313,956 × 6
   group    state         sex       age_group    outcome                       n
   &lt;chr&gt;    &lt;chr&gt;         &lt;chr&gt;     &lt;chr&gt;        &lt;chr&gt;                     &lt;int&gt;
 1 By Total United States All Sexes All ages     covid_19_deaths          5.40e5
 2 By Total United States All Sexes All ages     total_deaths             4.16e6
 3 By Total United States All Sexes All ages     pneumonia_deaths         4.66e5
 4 By Total United States All Sexes All ages     pneumonia_and_covid_19_… 2.63e5
 5 By Total United States All Sexes All ages     influenza_deaths         9.04e3
 6 By Total United States All Sexes All ages     pneumonia_influenza_or_… 7.51e5
 7 By Total United States All Sexes Under 1 year covid_19_deaths          5.9 e1
 8 By Total United States All Sexes Under 1 year total_deaths             2.26e4
 9 By Total United States All Sexes Under 1 year pneumonia_deaths         2.46e2
10 By Total United States All Sexes Under 1 year pneumonia_and_covid_19_… 1   e1
# ℹ 313,946 more rows</code></pre>
</div>
</div>
</div></div>
</section>
<section id="if-we-wanted-to-4" class="slide level2">
<h2>If we wanted to …</h2>
<div class="columns smallcode">
<div class="column" style="width:50%;">
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb71" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb71-1"><a aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(stringr)  <span class="co"># it's back!</span></span>
<span id="cb71-2"><a aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-3"><a aria-hidden="true" tabindex="-1"></a>nchs <span class="sc">|&gt;</span></span>
<span id="cb71-4"><a aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">!</span>(<span class="fu">c</span>(data_as_of<span class="sc">:</span>end_date, year, month))) <span class="sc">|&gt;</span></span>
<span id="cb71-5"><a aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(covid_19_deaths<span class="sc">:</span>pneumonia_influenza_or_covid_19_deaths,</span>
<span id="cb71-6"><a aria-hidden="true" tabindex="-1"></a>               <span class="at">names_to =</span> <span class="st">"outcome"</span>,</span>
<span id="cb71-7"><a aria-hidden="true" tabindex="-1"></a>               <span class="at">values_to =</span> <span class="st">"n"</span>) <span class="sc">|&gt;</span></span>
<span id="cb71-8"><a aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">outcome =</span> <span class="fu">str_to_sentence</span>(outcome),</span>
<span id="cb71-9"><a aria-hidden="true" tabindex="-1"></a>         <span class="at">outcome =</span> <span class="fu">str_replace_all</span>(outcome, <span class="st">"_"</span>, <span class="st">" "</span>),</span>
<span id="cb71-10"><a aria-hidden="true" tabindex="-1"></a>         <span class="at">outcome =</span> <span class="fu">str_replace</span>(outcome, <span class="st">"(C|c)ovid 19"</span>, <span class="st">"COVID-19"</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</div><div class="column" style="width:50%;">
<div class="cell" data-layout-align="center">
<div class="cell-output cell-output-stdout">
<pre data-code-line-numbers=""><code># A tibble: 313,956 × 6
   group    state         sex       age_group    outcome                       n
   &lt;chr&gt;    &lt;chr&gt;         &lt;chr&gt;     &lt;chr&gt;        &lt;chr&gt;                     &lt;int&gt;
 1 By Total United States All Sexes All ages     COVID-19 deaths          5.40e5
 2 By Total United States All Sexes All ages     Total deaths             4.16e6
 3 By Total United States All Sexes All ages     Pneumonia deaths         4.66e5
 4 By Total United States All Sexes All ages     Pneumonia and COVID-19 … 2.63e5
 5 By Total United States All Sexes All ages     Influenza deaths         9.04e3
 6 By Total United States All Sexes All ages     Pneumonia influenza or … 7.51e5
 7 By Total United States All Sexes Under 1 year COVID-19 deaths          5.9 e1
 8 By Total United States All Sexes Under 1 year Total deaths             2.26e4
 9 By Total United States All Sexes Under 1 year Pneumonia deaths         2.46e2
10 By Total United States All Sexes Under 1 year Pneumonia and COVID-19 … 1   e1
# ℹ 313,946 more rows</code></pre>
</div>
</div>
</div></div>
</section>
<section id="if-we-wanted-to-5" class="slide level2">
<h2>If we wanted to …</h2>
<ul>
<li>Put this in an object called <code>nchs_fmt</code></li>
</ul>
</section>
<section id="we-could-make-a-table-or-graph" class="slide level2">
<h2>… we could make a table or graph</h2>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb73" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb73-1"><a aria-hidden="true" tabindex="-1"></a>nchs_fmt <span class="sc">|&gt;</span> </span>
<span id="cb73-2"><a aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(state, age_group, outcome, n)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre data-code-line-numbers=""><code># A tibble: 313,956 × 4
   state         age_group    outcome                                      n
   &lt;chr&gt;         &lt;chr&gt;        &lt;chr&gt;                                    &lt;int&gt;
 1 United States All ages     COVID-19 deaths                         539723
 2 United States All ages     Total deaths                           4161167
 3 United States All ages     Pneumonia deaths                        466437
 4 United States All ages     Pneumonia and COVID-19 deaths           263147
 5 United States All ages     Influenza deaths                          9037
 6 United States All ages     Pneumonia influenza or COVID-19 deaths  750804
 7 United States Under 1 year COVID-19 deaths                             59
 8 United States Under 1 year Total deaths                             22626
 9 United States Under 1 year Pneumonia deaths                           246
10 United States Under 1 year Pneumonia and COVID-19 deaths               10
# ℹ 313,946 more rows</code></pre>
</div>
</div>
</section>
<section id="cleaned-up-but-not-tidy" class="slide level2">
<h2>Cleaned up (but not tidy)</h2>
<div class="columns">
<div class="column" style="width:50%;">
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb75" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb75-1"><a aria-hidden="true" tabindex="-1"></a>nchs_fmt <span class="sc">|&gt;</span> </span>
<span id="cb75-2"><a aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(group)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre data-code-line-numbers=""><code># A tibble: 3 × 1
  group   
  &lt;chr&gt;   
1 By Total
2 By Year 
3 By Month</code></pre>
</div>
</div>
</div><div class="column right" style="width:50%;">

</div></div>
</section>
<section id="cleaned-up-but-not-tidy-1" class="slide level2">
<h2>Cleaned up (but not tidy)</h2>
<div class="columns">
<div class="column" style="width:50%;">
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb77" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb77-1"><a aria-hidden="true" tabindex="-1"></a>nchs_fmt <span class="sc">|&gt;</span> </span>
<span id="cb77-2"><a aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(group)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre data-code-line-numbers=""><code># A tibble: 3 × 1
  group   
  &lt;chr&gt;   
1 By Total
2 By Year 
3 By Month</code></pre>
</div>
</div>
</div><div class="column right" style="width:50%;">
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb79" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb79-1"><a aria-hidden="true" tabindex="-1"></a>nchs_fmt <span class="sc">|&gt;</span> </span>
<span id="cb79-2"><a aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(age_group)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre data-code-line-numbers=""><code># A tibble: 17 × 1
   age_group        
   &lt;chr&gt;            
 1 All ages         
 2 Under 1 year     
 3 0-17 years       
 4 1-4 years        
 5 5-14 years       
 6 15-24 years      
 7 18-29 years      
 8 25-34 years      
 9 30-39 years      
10 35-44 years      
11 40-49 years      
12 45-54 years      
13 50-64 years      
14 55-64 years      
15 65-74 years      
16 75-84 years      
17 85 years and over</code></pre>
</div>
</div>
</div></div>
</section>
<section id="make-our-plot" class="slide level2">
<h2>Make our plot</h2>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb81" data-source-line-numbers="nil" data-code-line-numbers="13,14,15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb81-1"><a aria-hidden="true" tabindex="-1"></a>p_out <span class="ot">&lt;-</span> nchs_fmt <span class="sc">|&gt;</span> </span>
<span id="cb81-2"><a aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(group <span class="sc">%in%</span> <span class="st">"By Total"</span>, </span>
<span id="cb81-3"><a aria-hidden="true" tabindex="-1"></a>         sex <span class="sc">%in%</span> <span class="st">"All Sexes"</span>, </span>
<span id="cb81-4"><a aria-hidden="true" tabindex="-1"></a>         state <span class="sc">%in%</span> <span class="st">"United States"</span>, </span>
<span id="cb81-5"><a aria-hidden="true" tabindex="-1"></a>         age_group <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"0-17 years"</span>, </span>
<span id="cb81-6"><a aria-hidden="true" tabindex="-1"></a>                          <span class="st">"18-29 years"</span>,</span>
<span id="cb81-7"><a aria-hidden="true" tabindex="-1"></a>                          <span class="st">"30-39 years"</span>,</span>
<span id="cb81-8"><a aria-hidden="true" tabindex="-1"></a>                          <span class="st">"40-49 years"</span>,</span>
<span id="cb81-9"><a aria-hidden="true" tabindex="-1"></a>                          <span class="st">"50-64 years"</span>,</span>
<span id="cb81-10"><a aria-hidden="true" tabindex="-1"></a>                          <span class="st">"65-74 years"</span>,</span>
<span id="cb81-11"><a aria-hidden="true" tabindex="-1"></a>                          <span class="st">"85 years and over"</span>),  </span>
<span id="cb81-12"><a aria-hidden="true" tabindex="-1"></a>         outcome <span class="sc">%in%</span> <span class="st">"COVID-19 deaths"</span>) <span class="sc">|&gt;</span></span>
<span id="cb81-13"><a aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">age_group =</span> <span class="fu">str_replace</span>(age_group, <span class="st">"years"</span>, <span class="st">"yrs"</span>),</span>
<span id="cb81-14"><a aria-hidden="true" tabindex="-1"></a>         <span class="at">age_group =</span> <span class="fu">str_replace</span>(age_group, <span class="st">" and over"</span>, <span class="st">""</span>),</span>
<span id="cb81-15"><a aria-hidden="true" tabindex="-1"></a>         <span class="at">age_group =</span> <span class="fu">str_replace</span>(age_group, <span class="st">"85"</span>, <span class="st">"85+"</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb81-16"><a aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> n, <span class="at">y =</span> age_group)) <span class="sc">+</span></span>
<span id="cb81-17"><a aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>() <span class="sc">+</span> <span class="fu">scale_x_continuous</span>(<span class="at">labels =</span> scales<span class="sc">::</span>comma) <span class="sc">+</span> </span>
<span id="cb81-18"><a aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Deaths"</span>, <span class="at">y =</span> <span class="cn">NULL</span>, <span class="at">title =</span> <span class="st">"U.S. COVID-19 mortality totals by age group"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="result" class="slide level2">
<h2>Result</h2>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb82" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb82-1"><a aria-hidden="true" tabindex="-1"></a>p_out</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>

</div>
<img data-src="06-getting-data-in_files/figure-revealjs/06-getting-data-in-36-1.png" class="quarto-figure quarto-figure-center r-stretch" width="1152"></section>
<section class="slide level2">

<div class="huge">
<p><span class="fg-orange">Every dataset is different</span></p>
</div>
</section></section>
<section>
<section id="dropping-missings" class="title-slide slide level1 inv-title center" data-background-color="#252F3E">
<h1>Dropping missings</h1>

</section>
<section id="dropping-missing-values" class="slide level2">
<h2>Dropping <span class="fg-orange">missing values</span></h2>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb83" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb83-1"><a aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">tribble</span>(</span>
<span id="cb83-2"><a aria-hidden="true" tabindex="-1"></a>  <span class="sc">~</span>a, <span class="sc">~</span>b, <span class="sc">~</span>c,</span>
<span id="cb83-3"><a aria-hidden="true" tabindex="-1"></a>  <span class="dv">1</span>, <span class="cn">NA</span>, <span class="dv">2</span>,</span>
<span id="cb83-4"><a aria-hidden="true" tabindex="-1"></a>  <span class="cn">NA</span>, <span class="cn">NA</span>, <span class="cn">NA</span>, </span>
<span id="cb83-5"><a aria-hidden="true" tabindex="-1"></a>  <span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">2</span></span>
<span id="cb83-6"><a aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb83-7"><a aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-8"><a aria-hidden="true" tabindex="-1"></a>df</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre data-code-line-numbers=""><code># A tibble: 3 × 3
      a     b     c
  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
1     1    NA     2
2    NA    NA    NA
3     2     2     2</code></pre>
</div>
</div>
</section>
<section id="dropping-missing-values-1" class="slide level2">
<h2>Dropping <span class="fg-orange">missing values</span></h2>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb85" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb85-1"><a aria-hidden="true" tabindex="-1"></a><span class="co"># 2 Convenience function</span></span>
<span id="cb85-2"><a aria-hidden="true" tabindex="-1"></a>df <span class="sc">|&gt;</span> </span>
<span id="cb85-3"><a aria-hidden="true" tabindex="-1"></a>  <span class="fu">drop_na</span>()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre data-code-line-numbers=""><code># A tibble: 1 × 3
      a     b     c
  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
1     2     2     2</code></pre>
</div>
</div>
<ul>
<li>Drops all rows with <em>any</em> missing cases.</li>
</ul>
</section>
<section id="dropping-missing-values-2" class="slide level2">
<h2>Dropping <span class="fg-orange">missing values</span></h2>
<ul>
<li>What if we only want to drop all rows with <em>all</em> missing cases?</li>
</ul>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb87" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb87-1"><a aria-hidden="true" tabindex="-1"></a><span class="co"># 3</span></span>
<span id="cb87-2"><a aria-hidden="true" tabindex="-1"></a>df <span class="sc">|&gt;</span> </span>
<span id="cb87-3"><a aria-hidden="true" tabindex="-1"></a>  <span class="co"># Anonymous function \(x)</span></span>
<span id="cb87-4"><a aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">if_all</span>(<span class="fu">everything</span>(), \(x) <span class="fu">is.na</span>(x))) </span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre data-code-line-numbers=""><code># A tibble: 2 × 3
      a     b     c
  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
1     1    NA     2
2     2     2     2</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb89" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb89-1"><a aria-hidden="true" tabindex="-1"></a><span class="co"># 4 Convenience function from janitor</span></span>
<span id="cb89-2"><a aria-hidden="true" tabindex="-1"></a>df <span class="sc">|&gt;</span> </span>
<span id="cb89-3"><a aria-hidden="true" tabindex="-1"></a>  janitor<span class="sc">::</span><span class="fu">remove_empty</span>(<span class="st">"rows"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre data-code-line-numbers=""><code># A tibble: 2 × 3
      a     b     c
  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
1     1    NA     2
2     2     2     2</code></pre>
</div>
</div>
</section></section>
<section>
<section id="example-cleaning-a-table" class="title-slide slide level1 inv-title center" data-background-color="#252F3E">
<h1>Example: cleaning a table</h1>

</section>
<section id="cleaning-a-table" class="slide level2">
<h2>Cleaning a table</h2>
<ul>
<li>With that in mind … Some marketing data</li>
</ul>

<img data-src="img/rfm_table.png" class="r-stretch"></section>
<section id="cleaning-a-table-1" class="slide level2">
<h2>Cleaning a table</h2>
<div class="columns smallcode">
<div class="column" style="width:40%;">
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb91" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb91-1"><a aria-hidden="true" tabindex="-1"></a><span class="fu">read_csv</span>(<span class="fu">here</span>(<span class="st">"data"</span>, <span class="st">"rfm_table.csv"</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</div><div class="column" style="width:60%;">
<div class="cell" data-layout-align="center">
<div class="cell-output cell-output-stdout">
<pre data-code-line-numbers=""><code># A tibble: 23 × 5
   SEGMENT            DESCRIPTION                              R     F     M    
   &lt;chr&gt;              &lt;chr&gt;                                    &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;
 1 &lt;NA&gt;               &lt;NA&gt;                                     &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt; 
 2 Champions          Bought recently, buy often and spend th… 4– 5  4– 5  4– 5 
 3 &lt;NA&gt;               &lt;NA&gt;                                     &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt; 
 4 Loyal Customers    Spend good money. Responsive to promoti… 2– 5  3– 5  3– 5 
 5 &lt;NA&gt;               &lt;NA&gt;                                     &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt; 
 6 Potential Loyalist Recent customers, spent good amount, bo… 3– 5  1– 3  1– 3 
 7 &lt;NA&gt;               &lt;NA&gt;                                     &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt; 
 8 New Customers      Bought more recently, but not often      4– 5  &lt;= 1  &lt;= 1 
 9 &lt;NA&gt;               &lt;NA&gt;                                     &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt; 
10 Promising          Recent shoppers, but haven’t spent much  3– 4  &lt;= 1  &lt;= 1 
# ℹ 13 more rows</code></pre>
</div>
</div>
</div></div>
</section>
<section id="cleaning-a-table-2" class="slide level2">
<h2>Cleaning a table</h2>
<div class="columns smallcode">
<div class="column" style="width:40%;">
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb93" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb93-1"><a aria-hidden="true" tabindex="-1"></a><span class="fu">read_csv</span>(<span class="fu">here</span>(<span class="st">"data"</span>, <span class="st">"rfm_table.csv"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb93-2"><a aria-hidden="true" tabindex="-1"></a>  janitor<span class="sc">::</span><span class="fu">clean_names</span>()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</div><div class="column" style="width:60%;">
<div class="cell" data-layout-align="center">
<div class="cell-output cell-output-stdout">
<pre data-code-line-numbers=""><code># A tibble: 23 × 5
   segment            description                              r     f     m    
   &lt;chr&gt;              &lt;chr&gt;                                    &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;
 1 &lt;NA&gt;               &lt;NA&gt;                                     &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt; 
 2 Champions          Bought recently, buy often and spend th… 4– 5  4– 5  4– 5 
 3 &lt;NA&gt;               &lt;NA&gt;                                     &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt; 
 4 Loyal Customers    Spend good money. Responsive to promoti… 2– 5  3– 5  3– 5 
 5 &lt;NA&gt;               &lt;NA&gt;                                     &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt; 
 6 Potential Loyalist Recent customers, spent good amount, bo… 3– 5  1– 3  1– 3 
 7 &lt;NA&gt;               &lt;NA&gt;                                     &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt; 
 8 New Customers      Bought more recently, but not often      4– 5  &lt;= 1  &lt;= 1 
 9 &lt;NA&gt;               &lt;NA&gt;                                     &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt; 
10 Promising          Recent shoppers, but haven’t spent much  3– 4  &lt;= 1  &lt;= 1 
# ℹ 13 more rows</code></pre>
</div>
</div>
</div></div>
</section>
<section id="cleaning-a-table-3" class="slide level2">
<h2>Cleaning a table</h2>
<div class="columns smallcode">
<div class="column" style="width:40%;">
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb95" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb95-1"><a aria-hidden="true" tabindex="-1"></a><span class="fu">read_csv</span>(<span class="fu">here</span>(<span class="st">"data"</span>, <span class="st">"rfm_table.csv"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb95-2"><a aria-hidden="true" tabindex="-1"></a>  janitor<span class="sc">::</span><span class="fu">clean_names</span>() <span class="sc">|&gt;</span></span>
<span id="cb95-3"><a aria-hidden="true" tabindex="-1"></a>  janitor<span class="sc">::</span><span class="fu">remove_empty</span>(<span class="st">"rows"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</div><div class="column" style="width:60%;">
<div class="cell" data-layout-align="center">
<div class="cell-output cell-output-stdout">
<pre data-code-line-numbers=""><code># A tibble: 11 × 5
   segment            description                              r     f     m    
   &lt;chr&gt;              &lt;chr&gt;                                    &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;
 1 Champions          Bought recently, buy often and spend th… 4– 5  4– 5  4– 5 
 2 Loyal Customers    Spend good money. Responsive to promoti… 2– 5  3– 5  3– 5 
 3 Potential Loyalist Recent customers, spent good amount, bo… 3– 5  1– 3  1– 3 
 4 New Customers      Bought more recently, but not often      4– 5  &lt;= 1  &lt;= 1 
 5 Promising          Recent shoppers, but haven’t spent much  3– 4  &lt;= 1  &lt;= 1 
 6 Need Attention     Above average recency, frequency &amp; mone… 2– 3  2– 3  2– 3 
 7 About To Sleep     Below average recency, frequency &amp; mone… 2– 3  &lt;= 2  &lt;= 2 
 8 At Risk            Spent big money, purchased often but lo… &lt;= 2  2– 5  2– 5 
 9 Can’t Lose Them    Made big purchases and often, but long … &lt;= 1  4– 5  4– 5 
10 Hibernating        Low spenders, low frequency, purchased … 1– 2  1– 2  1– 2 
11 Lost               Lowest recency, frequency &amp; monetary sc… &lt;= 2  &lt;= 2  &lt;= 2 </code></pre>
</div>
</div>
</div></div>
</section>
<section id="cleaning-a-table-4" class="slide level2">
<h2>Cleaning a table</h2>
<div class="columns smallcode">
<div class="column" style="width:40%;">
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb97" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb97-1"><a aria-hidden="true" tabindex="-1"></a><span class="fu">read_csv</span>(<span class="fu">here</span>(<span class="st">"data"</span>, <span class="st">"rfm_table.csv"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb97-2"><a aria-hidden="true" tabindex="-1"></a>  janitor<span class="sc">::</span><span class="fu">clean_names</span>() <span class="sc">|&gt;</span></span>
<span id="cb97-3"><a aria-hidden="true" tabindex="-1"></a>  janitor<span class="sc">::</span><span class="fu">remove_empty</span>(<span class="st">"rows"</span>) <span class="sc">|&gt;</span></span>
<span id="cb97-4"><a aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> r<span class="sc">:</span>m)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</div><div class="column" style="width:60%;">
<div class="cell" data-layout-align="center">
<div class="cell-output cell-output-stdout">
<pre data-code-line-numbers=""><code># A tibble: 33 × 4
   segment            description                                    name  value
   &lt;chr&gt;              &lt;chr&gt;                                          &lt;chr&gt; &lt;chr&gt;
 1 Champions          Bought recently, buy often and spend the most  r     4– 5 
 2 Champions          Bought recently, buy often and spend the most  f     4– 5 
 3 Champions          Bought recently, buy often and spend the most  m     4– 5 
 4 Loyal Customers    Spend good money. Responsive to promotions     r     2– 5 
 5 Loyal Customers    Spend good money. Responsive to promotions     f     3– 5 
 6 Loyal Customers    Spend good money. Responsive to promotions     m     3– 5 
 7 Potential Loyalist Recent customers, spent good amount, bought m… r     3– 5 
 8 Potential Loyalist Recent customers, spent good amount, bought m… f     1– 3 
 9 Potential Loyalist Recent customers, spent good amount, bought m… m     1– 3 
10 New Customers      Bought more recently, but not often            r     4– 5 
# ℹ 23 more rows</code></pre>
</div>
</div>
</div></div>
</section>
<section id="cleaning-a-table-5" class="slide level2">
<h2>Cleaning a table</h2>
<div class="columns smallcode">
<div class="column" style="width:40%;">
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb99" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb99-1"><a aria-hidden="true" tabindex="-1"></a><span class="fu">read_csv</span>(<span class="fu">here</span>(<span class="st">"data"</span>, <span class="st">"rfm_table.csv"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb99-2"><a aria-hidden="true" tabindex="-1"></a>  janitor<span class="sc">::</span><span class="fu">clean_names</span>() <span class="sc">|&gt;</span></span>
<span id="cb99-3"><a aria-hidden="true" tabindex="-1"></a>  janitor<span class="sc">::</span><span class="fu">remove_empty</span>(<span class="st">"rows"</span>) <span class="sc">|&gt;</span></span>
<span id="cb99-4"><a aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> r<span class="sc">:</span>m) <span class="sc">|&gt;</span></span>
<span id="cb99-5"><a aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate</span>(<span class="at">col =</span> value, <span class="at">into =</span> <span class="fu">c</span>(<span class="st">"lo"</span>, <span class="st">"hi"</span>),</span>
<span id="cb99-6"><a aria-hidden="true" tabindex="-1"></a>           <span class="at">remove =</span> <span class="cn">FALSE</span>, <span class="at">convert =</span> <span class="cn">TRUE</span>,</span>
<span id="cb99-7"><a aria-hidden="true" tabindex="-1"></a>           <span class="at">fill =</span> <span class="st">"left"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</div><div class="column" style="width:60%;">
<div class="cell" data-layout-align="center">
<div class="cell-output cell-output-stdout">
<pre data-code-line-numbers=""><code># A tibble: 33 × 6
   segment            description                        name  value    lo    hi
   &lt;chr&gt;              &lt;chr&gt;                              &lt;chr&gt; &lt;chr&gt; &lt;int&gt; &lt;int&gt;
 1 Champions          Bought recently, buy often and sp… r     4– 5      4     5
 2 Champions          Bought recently, buy often and sp… f     4– 5      4     5
 3 Champions          Bought recently, buy often and sp… m     4– 5      4     5
 4 Loyal Customers    Spend good money. Responsive to p… r     2– 5      2     5
 5 Loyal Customers    Spend good money. Responsive to p… f     3– 5      3     5
 6 Loyal Customers    Spend good money. Responsive to p… m     3– 5      3     5
 7 Potential Loyalist Recent customers, spent good amou… r     3– 5      3     5
 8 Potential Loyalist Recent customers, spent good amou… f     1– 3      1     3
 9 Potential Loyalist Recent customers, spent good amou… m     1– 3      1     3
10 New Customers      Bought more recently, but not oft… r     4– 5      4     5
# ℹ 23 more rows</code></pre>
</div>
</div>
</div></div>
</section>
<section id="cleaning-a-table-6" class="slide level2">
<h2>Cleaning a table</h2>
<div class="columns smallcode">
<div class="column" style="width:40%;">
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb101" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb101-1"><a aria-hidden="true" tabindex="-1"></a><span class="fu">read_csv</span>(<span class="fu">here</span>(<span class="st">"data"</span>, <span class="st">"rfm_table.csv"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb101-2"><a aria-hidden="true" tabindex="-1"></a>  janitor<span class="sc">::</span><span class="fu">clean_names</span>() <span class="sc">|&gt;</span></span>
<span id="cb101-3"><a aria-hidden="true" tabindex="-1"></a>  janitor<span class="sc">::</span><span class="fu">remove_empty</span>(<span class="st">"rows"</span>) <span class="sc">|&gt;</span></span>
<span id="cb101-4"><a aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> r<span class="sc">:</span>m) <span class="sc">|&gt;</span></span>
<span id="cb101-5"><a aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate</span>(<span class="at">col =</span> value, <span class="at">into =</span> <span class="fu">c</span>(<span class="st">"lo"</span>, <span class="st">"hi"</span>),</span>
<span id="cb101-6"><a aria-hidden="true" tabindex="-1"></a>           <span class="at">remove =</span> <span class="cn">FALSE</span>, <span class="at">convert =</span> <span class="cn">TRUE</span>,</span>
<span id="cb101-7"><a aria-hidden="true" tabindex="-1"></a>           <span class="at">fill =</span> <span class="st">"left"</span>) <span class="sc">|&gt;</span></span>
<span id="cb101-8"><a aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>value)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</div><div class="column" style="width:60%;">
<div class="cell" data-layout-align="center">
<div class="cell-output cell-output-stdout">
<pre data-code-line-numbers=""><code># A tibble: 33 × 5
   segment            description                              name     lo    hi
   &lt;chr&gt;              &lt;chr&gt;                                    &lt;chr&gt; &lt;int&gt; &lt;int&gt;
 1 Champions          Bought recently, buy often and spend th… r         4     5
 2 Champions          Bought recently, buy often and spend th… f         4     5
 3 Champions          Bought recently, buy often and spend th… m         4     5
 4 Loyal Customers    Spend good money. Responsive to promoti… r         2     5
 5 Loyal Customers    Spend good money. Responsive to promoti… f         3     5
 6 Loyal Customers    Spend good money. Responsive to promoti… m         3     5
 7 Potential Loyalist Recent customers, spent good amount, bo… r         3     5
 8 Potential Loyalist Recent customers, spent good amount, bo… f         1     3
 9 Potential Loyalist Recent customers, spent good amount, bo… m         1     3
10 New Customers      Bought more recently, but not often      r         4     5
# ℹ 23 more rows</code></pre>
</div>
</div>
</div></div>
</section>
<section id="cleaning-a-table-7" class="slide level2">
<h2>Cleaning a table</h2>
<div class="columns smallcode">
<div class="column" style="width:40%;">
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb103" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb103-1"><a aria-hidden="true" tabindex="-1"></a><span class="fu">read_csv</span>(<span class="fu">here</span>(<span class="st">"data"</span>, <span class="st">"rfm_table.csv"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb103-2"><a aria-hidden="true" tabindex="-1"></a>  janitor<span class="sc">::</span><span class="fu">clean_names</span>() <span class="sc">|&gt;</span></span>
<span id="cb103-3"><a aria-hidden="true" tabindex="-1"></a>  janitor<span class="sc">::</span><span class="fu">remove_empty</span>(<span class="st">"rows"</span>) <span class="sc">|&gt;</span></span>
<span id="cb103-4"><a aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> r<span class="sc">:</span>m) <span class="sc">|&gt;</span></span>
<span id="cb103-5"><a aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate</span>(<span class="at">col =</span> value, <span class="at">into =</span> <span class="fu">c</span>(<span class="st">"lo"</span>, <span class="st">"hi"</span>),</span>
<span id="cb103-6"><a aria-hidden="true" tabindex="-1"></a>           <span class="at">remove =</span> <span class="cn">FALSE</span>, <span class="at">convert =</span> <span class="cn">TRUE</span>,</span>
<span id="cb103-7"><a aria-hidden="true" tabindex="-1"></a>           <span class="at">fill =</span> <span class="st">"left"</span>) <span class="sc">|&gt;</span></span>
<span id="cb103-8"><a aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>value) <span class="sc">|&gt;</span></span>
<span id="cb103-9"><a aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> name,</span>
<span id="cb103-10"><a aria-hidden="true" tabindex="-1"></a>              <span class="at">values_from =</span> lo<span class="sc">:</span>hi)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</div><div class="column" style="width:60%;">
<div class="cell" data-layout-align="center">
<div class="cell-output cell-output-stdout">
<pre data-code-line-numbers=""><code># A tibble: 11 × 8
   segment            description             lo_r  lo_f  lo_m  hi_r  hi_f  hi_m
   &lt;chr&gt;              &lt;chr&gt;                  &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt;
 1 Champions          Bought recently, buy …     4     4     4     5     5     5
 2 Loyal Customers    Spend good money. Res…     2     3     3     5     5     5
 3 Potential Loyalist Recent customers, spe…     3     1     1     5     3     3
 4 New Customers      Bought more recently,…     4    NA    NA     5     1     1
 5 Promising          Recent shoppers, but …     3    NA    NA     4     1     1
 6 Need Attention     Above average recency…     2     2     2     3     3     3
 7 About To Sleep     Below average recency…     2    NA    NA     3     2     2
 8 At Risk            Spent big money, purc…    NA     2     2     2     5     5
 9 Can’t Lose Them    Made big purchases an…    NA     4     4     1     5     5
10 Hibernating        Low spenders, low fre…     1     1     1     2     2     2
11 Lost               Lowest recency, frequ…    NA    NA    NA     2     2     2</code></pre>
</div>
</div>
</div></div>
</section>
<section id="cleaning-a-table-8" class="slide level2">
<h2>Cleaning a table</h2>
<div class="columns smallcode">
<div class="column" style="width:40%;">
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb105" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb105-1"><a aria-hidden="true" tabindex="-1"></a><span class="fu">read_csv</span>(<span class="fu">here</span>(<span class="st">"data"</span>, <span class="st">"rfm_table.csv"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb105-2"><a aria-hidden="true" tabindex="-1"></a>  janitor<span class="sc">::</span><span class="fu">clean_names</span>() <span class="sc">|&gt;</span></span>
<span id="cb105-3"><a aria-hidden="true" tabindex="-1"></a>  janitor<span class="sc">::</span><span class="fu">remove_empty</span>(<span class="st">"rows"</span>) <span class="sc">|&gt;</span></span>
<span id="cb105-4"><a aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> r<span class="sc">:</span>m) <span class="sc">|&gt;</span></span>
<span id="cb105-5"><a aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate</span>(<span class="at">col =</span> value, <span class="at">into =</span> <span class="fu">c</span>(<span class="st">"lo"</span>, <span class="st">"hi"</span>),</span>
<span id="cb105-6"><a aria-hidden="true" tabindex="-1"></a>           <span class="at">remove =</span> <span class="cn">FALSE</span>, <span class="at">convert =</span> <span class="cn">TRUE</span>,</span>
<span id="cb105-7"><a aria-hidden="true" tabindex="-1"></a>           <span class="at">fill =</span> <span class="st">"left"</span>) <span class="sc">|&gt;</span></span>
<span id="cb105-8"><a aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>value) <span class="sc">|&gt;</span></span>
<span id="cb105-9"><a aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> name,</span>
<span id="cb105-10"><a aria-hidden="true" tabindex="-1"></a>              <span class="at">values_from =</span> lo<span class="sc">:</span>hi) <span class="sc">|&gt;</span></span>
<span id="cb105-11"><a aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">where</span>(is.integer), \(x) <span class="fu">replace_na</span>(x, <span class="dv">0</span>)))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</div><div class="column" style="width:60%;">
<div class="cell" data-layout-align="center">
<div class="cell-output cell-output-stdout">
<pre data-code-line-numbers=""><code># A tibble: 11 × 8
   segment            description             lo_r  lo_f  lo_m  hi_r  hi_f  hi_m
   &lt;chr&gt;              &lt;chr&gt;                  &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt;
 1 Champions          Bought recently, buy …     4     4     4     5     5     5
 2 Loyal Customers    Spend good money. Res…     2     3     3     5     5     5
 3 Potential Loyalist Recent customers, spe…     3     1     1     5     3     3
 4 New Customers      Bought more recently,…     4     0     0     5     1     1
 5 Promising          Recent shoppers, but …     3     0     0     4     1     1
 6 Need Attention     Above average recency…     2     2     2     3     3     3
 7 About To Sleep     Below average recency…     2     0     0     3     2     2
 8 At Risk            Spent big money, purc…     0     2     2     2     5     5
 9 Can’t Lose Them    Made big purchases an…     0     4     4     1     5     5
10 Hibernating        Low spenders, low fre…     1     1     1     2     2     2
11 Lost               Lowest recency, frequ…     0     0     0     2     2     2</code></pre>
</div>
</div>
</div></div>
</section>
<section id="cleaning-a-table-9" class="slide level2">
<h2>Cleaning a table</h2>
<div class="columns smallcode">
<div class="column" style="width:40%;">
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb107" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb107-1"><a aria-hidden="true" tabindex="-1"></a><span class="fu">read_csv</span>(<span class="fu">here</span>(<span class="st">"data"</span>, <span class="st">"rfm_table.csv"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb107-2"><a aria-hidden="true" tabindex="-1"></a>  janitor<span class="sc">::</span><span class="fu">clean_names</span>() <span class="sc">|&gt;</span></span>
<span id="cb107-3"><a aria-hidden="true" tabindex="-1"></a>  janitor<span class="sc">::</span><span class="fu">remove_empty</span>(<span class="st">"rows"</span>) <span class="sc">|&gt;</span></span>
<span id="cb107-4"><a aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> r<span class="sc">:</span>m) <span class="sc">|&gt;</span></span>
<span id="cb107-5"><a aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate</span>(<span class="at">col =</span> value, <span class="at">into =</span> <span class="fu">c</span>(<span class="st">"lo"</span>, <span class="st">"hi"</span>),</span>
<span id="cb107-6"><a aria-hidden="true" tabindex="-1"></a>           <span class="at">remove =</span> <span class="cn">FALSE</span>, <span class="at">convert =</span> <span class="cn">TRUE</span>,</span>
<span id="cb107-7"><a aria-hidden="true" tabindex="-1"></a>           <span class="at">fill =</span> <span class="st">"left"</span>) <span class="sc">|&gt;</span></span>
<span id="cb107-8"><a aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>value) <span class="sc">|&gt;</span></span>
<span id="cb107-9"><a aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> name,</span>
<span id="cb107-10"><a aria-hidden="true" tabindex="-1"></a>              <span class="at">values_from =</span> lo<span class="sc">:</span>hi) <span class="sc">|&gt;</span></span>
<span id="cb107-11"><a aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">where</span>(is.integer), \(x) <span class="fu">replace_na</span>(x, <span class="dv">0</span>))) <span class="sc">|&gt;</span></span>
<span id="cb107-12"><a aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(segment,</span>
<span id="cb107-13"><a aria-hidden="true" tabindex="-1"></a>         lo_r, hi_r,</span>
<span id="cb107-14"><a aria-hidden="true" tabindex="-1"></a>         lo_f, hi_f,</span>
<span id="cb107-15"><a aria-hidden="true" tabindex="-1"></a>         lo_m, hi_m,</span>
<span id="cb107-16"><a aria-hidden="true" tabindex="-1"></a>         description)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</div><div class="column" style="width:60%;">
<div class="cell" data-layout-align="center">
<div class="cell-output cell-output-stdout">
<pre data-code-line-numbers=""><code># A tibble: 11 × 8
   segment             lo_r  hi_r  lo_f  hi_f  lo_m  hi_m description           
   &lt;chr&gt;              &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;chr&gt;                 
 1 Champions              4     5     4     5     4     5 Bought recently, buy …
 2 Loyal Customers        2     5     3     5     3     5 Spend good money. Res…
 3 Potential Loyalist     3     5     1     3     1     3 Recent customers, spe…
 4 New Customers          4     5     0     1     0     1 Bought more recently,…
 5 Promising              3     4     0     1     0     1 Recent shoppers, but …
 6 Need Attention         2     3     2     3     2     3 Above average recency…
 7 About To Sleep         2     3     0     2     0     2 Below average recency…
 8 At Risk                0     2     2     5     2     5 Spent big money, purc…
 9 Can’t Lose Them        0     1     4     5     4     5 Made big purchases an…
10 Hibernating            1     2     1     2     1     2 Low spenders, low fre…
11 Lost                   0     2     0     2     0     2 Lowest recency, frequ…</code></pre>
</div>
</div>
</div></div>
</section>
<section id="a-candidate-for-rowwise" class="slide level2">
<h2>A candidate for <span class="fg-green"><code>rowwise()</code></span>?</h2>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb109" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb109-1"><a aria-hidden="true" tabindex="-1"></a>rfm_table</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre data-code-line-numbers=""><code># A tibble: 11 × 8
   segment             lo_r  hi_r  lo_f  hi_f  lo_m  hi_m description           
   &lt;chr&gt;              &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;chr&gt;                 
 1 Champions              4     5     4     5     4     5 Bought recently, buy …
 2 Loyal Customers        2     5     3     5     3     5 Spend good money. Res…
 3 Potential Loyalist     3     5     1     3     1     3 Recent customers, spe…
 4 New Customers          4     5     0     1     0     1 Bought more recently,…
 5 Promising              3     4     0     1     0     1 Recent shoppers, but …
 6 Need Attention         2     3     2     3     2     3 Above average recency…
 7 About To Sleep         2     3     0     2     0     2 Below average recency…
 8 At Risk                0     2     2     5     2     5 Spent big money, purc…
 9 Can’t Lose Them        0     1     4     5     4     5 Made big purchases an…
10 Hibernating            1     2     1     2     1     2 Low spenders, low fre…
11 Lost                   0     2     0     2     0     2 Lowest recency, frequ…</code></pre>
</div>
</div>
</section>
<section id="a-candidate-for-rowwise-1" class="slide level2">
<h2>A candidate for <span class="fg-green"><code>rowwise()</code></span>?</h2>
<ul>
<li>This does what we expect:</li>
</ul>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb111" data-source-line-numbers="nil" data-code-line-numbers="2,3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb111-1"><a aria-hidden="true" tabindex="-1"></a>rfm_table <span class="sc">|&gt;</span> </span>
<span id="cb111-2"><a aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">sum_lo =</span> lo_r <span class="sc">+</span> lo_f <span class="sc">+</span> lo_m,</span>
<span id="cb111-3"><a aria-hidden="true" tabindex="-1"></a>         <span class="at">sum_hi =</span> hi_r <span class="sc">+</span> hi_f <span class="sc">+</span> hi_m) <span class="sc">|&gt;</span> </span>
<span id="cb111-4"><a aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(segment, sum_lo, sum_hi, <span class="fu">everything</span>())</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre data-code-line-numbers=""><code># A tibble: 11 × 10
   segment         sum_lo sum_hi  lo_r  hi_r  lo_f  hi_f  lo_m  hi_m description
   &lt;chr&gt;            &lt;int&gt;  &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;chr&gt;      
 1 Champions           12     15     4     5     4     5     4     5 Bought rec…
 2 Loyal Customers      8     15     2     5     3     5     3     5 Spend good…
 3 Potential Loya…      5     11     3     5     1     3     1     3 Recent cus…
 4 New Customers        4      7     4     5     0     1     0     1 Bought mor…
 5 Promising            3      6     3     4     0     1     0     1 Recent sho…
 6 Need Attention       6      9     2     3     2     3     2     3 Above aver…
 7 About To Sleep       2      7     2     3     0     2     0     2 Below aver…
 8 At Risk              4     12     0     2     2     5     2     5 Spent big …
 9 Can’t Lose Them      8     11     0     1     4     5     4     5 Made big p…
10 Hibernating          3      6     1     2     1     2     1     2 Low spende…
11 Lost                 0      6     0     2     0     2     0     2 Lowest rec…</code></pre>
</div>
</div>
<div class="fragment" data-fragment-index="1">
<p>This adds each column, elementwise.</p>
</div>
</section>
<section id="a-candidate-for-rowwise-2" class="slide level2">
<h2>A candidate for <span class="fg-green"><code>rowwise()</code></span>?</h2>
<ul>
<li>But this does not:</li>
</ul>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb113" data-source-line-numbers="nil" data-code-line-numbers="2,3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb113-1"><a aria-hidden="true" tabindex="-1"></a>rfm_table <span class="sc">|&gt;</span> </span>
<span id="cb113-2"><a aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">sum_lo =</span> <span class="fu">sum</span>(lo_r, lo_f, lo_m),</span>
<span id="cb113-3"><a aria-hidden="true" tabindex="-1"></a>         <span class="at">sum_hi =</span> <span class="fu">sum</span>(hi_r, hi_f, hi_m)) <span class="sc">|&gt;</span></span>
<span id="cb113-4"><a aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(segment, sum_lo, sum_hi, <span class="fu">everything</span>())</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre data-code-line-numbers=""><code># A tibble: 11 × 10
   segment         sum_lo sum_hi  lo_r  hi_r  lo_f  hi_f  lo_m  hi_m description
   &lt;chr&gt;            &lt;int&gt;  &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;chr&gt;      
 1 Champions           55    105     4     5     4     5     4     5 Bought rec…
 2 Loyal Customers     55    105     2     5     3     5     3     5 Spend good…
 3 Potential Loya…     55    105     3     5     1     3     1     3 Recent cus…
 4 New Customers       55    105     4     5     0     1     0     1 Bought mor…
 5 Promising           55    105     3     4     0     1     0     1 Recent sho…
 6 Need Attention      55    105     2     3     2     3     2     3 Above aver…
 7 About To Sleep      55    105     2     3     0     2     0     2 Below aver…
 8 At Risk             55    105     0     2     2     5     2     5 Spent big …
 9 Can’t Lose Them     55    105     0     1     4     5     4     5 Made big p…
10 Hibernating         55    105     1     2     1     2     1     2 Low spende…
11 Lost                55    105     0     2     0     2     0     2 Lowest rec…</code></pre>
</div>
</div>
<ul>
<li>Sum is taking all the columns, adding them up (into a single number), and putting that result in each row.</li>
</ul>
</section>
<section id="a-candidate-for-rowwise-3" class="slide level2">
<h2>A candidate for <span class="fg-green"><code>rowwise()</code></span>?</h2>
<ul>
<li>Similarly, this will not give the answer we probably expect:</li>
</ul>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb115" data-source-line-numbers="nil" data-code-line-numbers="2,3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb115-1"><a aria-hidden="true" tabindex="-1"></a>rfm_table <span class="sc">|&gt;</span> </span>
<span id="cb115-2"><a aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">mean_lo =</span> <span class="fu">mean</span>(<span class="fu">c</span>(lo_r, lo_f, lo_m)),</span>
<span id="cb115-3"><a aria-hidden="true" tabindex="-1"></a>         <span class="at">mean_hi =</span> <span class="fu">mean</span>(<span class="fu">c</span>(hi_r, hi_f, hi_m))) <span class="sc">|&gt;</span></span>
<span id="cb115-4"><a aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(segment, mean_lo, mean_hi, <span class="fu">everything</span>())</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre data-code-line-numbers=""><code># A tibble: 11 × 10
   segment       mean_lo mean_hi  lo_r  hi_r  lo_f  hi_f  lo_m  hi_m description
   &lt;chr&gt;           &lt;dbl&gt;   &lt;dbl&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;chr&gt;      
 1 Champions        1.67    3.18     4     5     4     5     4     5 Bought rec…
 2 Loyal Custom…    1.67    3.18     2     5     3     5     3     5 Spend good…
 3 Potential Lo…    1.67    3.18     3     5     1     3     1     3 Recent cus…
 4 New Customers    1.67    3.18     4     5     0     1     0     1 Bought mor…
 5 Promising        1.67    3.18     3     4     0     1     0     1 Recent sho…
 6 Need Attenti…    1.67    3.18     2     3     2     3     2     3 Above aver…
 7 About To Sle…    1.67    3.18     2     3     0     2     0     2 Below aver…
 8 At Risk          1.67    3.18     0     2     2     5     2     5 Spent big …
 9 Can’t Lose T…    1.67    3.18     0     1     4     5     4     5 Made big p…
10 Hibernating      1.67    3.18     1     2     1     2     1     2 Low spende…
11 Lost             1.67    3.18     0     2     0     2     0     2 Lowest rec…</code></pre>
</div>
</div>
</section>
<section id="a-candidate-for-rowwise-4" class="slide level2">
<h2>A candidate for <span class="fg-green"><code>rowwise()</code></span>?</h2>
<ul>
<li>But this will:</li>
</ul>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb117" data-source-line-numbers="nil" data-code-line-numbers="2,3,4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb117-1"><a aria-hidden="true" tabindex="-1"></a>rfm_table <span class="sc">|&gt;</span> </span>
<span id="cb117-2"><a aria-hidden="true" tabindex="-1"></a>  <span class="fu">rowwise</span>() <span class="sc">|&gt;</span> </span>
<span id="cb117-3"><a aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">mean_lo =</span> <span class="fu">mean</span>(<span class="fu">c</span>(lo_r, lo_f, lo_m)),</span>
<span id="cb117-4"><a aria-hidden="true" tabindex="-1"></a>         <span class="at">mean_hi =</span> <span class="fu">mean</span>(<span class="fu">c</span>(hi_r, hi_f, hi_m))) <span class="sc">|&gt;</span></span>
<span id="cb117-5"><a aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(segment, mean_lo, mean_hi, <span class="fu">everything</span>())</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre data-code-line-numbers=""><code># A tibble: 11 × 10
# Rowwise: 
   segment       mean_lo mean_hi  lo_r  hi_r  lo_f  hi_f  lo_m  hi_m description
   &lt;chr&gt;           &lt;dbl&gt;   &lt;dbl&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;chr&gt;      
 1 Champions       4        5        4     5     4     5     4     5 Bought rec…
 2 Loyal Custom…   2.67     5        2     5     3     5     3     5 Spend good…
 3 Potential Lo…   1.67     3.67     3     5     1     3     1     3 Recent cus…
 4 New Customers   1.33     2.33     4     5     0     1     0     1 Bought mor…
 5 Promising       1        2        3     4     0     1     0     1 Recent sho…
 6 Need Attenti…   2        3        2     3     2     3     2     3 Above aver…
 7 About To Sle…   0.667    2.33     2     3     0     2     0     2 Below aver…
 8 At Risk         1.33     4        0     2     2     5     2     5 Spent big …
 9 Can’t Lose T…   2.67     3.67     0     1     4     5     4     5 Made big p…
10 Hibernating     1        2        1     2     1     2     1     2 Low spende…
11 Lost            0        2        0     2     0     2     0     2 Lowest rec…</code></pre>
</div>
</div>
</section>
<section id="rowwise-isnt-very-efficient" class="slide level2">
<h2>Rowwise isn’t very efficient</h2>
<ul>
<li class="fragment">In general, you’ll want to see if some vectorized (“operating on columns, but elementwise”) function exists, as it’ll be faster.</li>
<li class="fragment">And most of the time, R and the tidyverse “wants” you to work in vectorized, columnar terms … hence your first move will often be to pivot the data into long format.</li>
<li class="fragment">So, <span class="fg-green"><strong><code>rowwise()</code></strong></span> is not likely to see a whole lot of further development.</li>
</ul>
</section>
<section id="you-may-want-group_by-instead" class="slide level2">
<h2>You may want <span class="fg-green"><code>group_by()</code></span> instead</h2>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb119" data-source-line-numbers="nil" data-code-line-numbers="3,4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb119-1"><a aria-hidden="true" tabindex="-1"></a>rfm_table <span class="sc">|&gt;</span> </span>
<span id="cb119-2"><a aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(segment) <span class="sc">|&gt;</span> </span>
<span id="cb119-3"><a aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">mean_lo =</span> <span class="fu">mean</span>(<span class="fu">c</span>(lo_r, lo_f, lo_m)),</span>
<span id="cb119-4"><a aria-hidden="true" tabindex="-1"></a>         <span class="at">mean_hi =</span> <span class="fu">mean</span>(<span class="fu">c</span>(hi_r, hi_f, hi_m))) <span class="sc">|&gt;</span></span>
<span id="cb119-5"><a aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(segment, mean_lo, mean_hi, <span class="fu">everything</span>())</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre data-code-line-numbers=""><code># A tibble: 11 × 10
# Groups:   segment [11]
   segment       mean_lo mean_hi  lo_r  hi_r  lo_f  hi_f  lo_m  hi_m description
   &lt;chr&gt;           &lt;dbl&gt;   &lt;dbl&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;chr&gt;      
 1 Champions       4        5        4     5     4     5     4     5 Bought rec…
 2 Loyal Custom…   2.67     5        2     5     3     5     3     5 Spend good…
 3 Potential Lo…   1.67     3.67     3     5     1     3     1     3 Recent cus…
 4 New Customers   1.33     2.33     4     5     0     1     0     1 Bought mor…
 5 Promising       1        2        3     4     0     1     0     1 Recent sho…
 6 Need Attenti…   2        3        2     3     2     3     2     3 Above aver…
 7 About To Sle…   0.667    2.33     2     3     0     2     0     2 Below aver…
 8 At Risk         1.33     4        0     2     2     5     2     5 Spent big …
 9 Can’t Lose T…   2.67     3.67     0     1     4     5     4     5 Made big p…
10 Hibernating     1        2        1     2     1     2     1     2 Low spende…
11 Lost            0        2        0     2     0     2     0     2 Lowest rec…</code></pre>
</div>
</div>
</section>
<section id="you-may-want-group_by-instead-1" class="slide level2">
<h2>You may want <span class="fg-green"><code>group_by()</code></span> instead</h2>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb121" data-source-line-numbers="nil" data-code-line-numbers="3,4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb121-1"><a aria-hidden="true" tabindex="-1"></a>rfm_table <span class="sc">|&gt;</span> </span>
<span id="cb121-2"><a aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(segment) <span class="sc">|&gt;</span> </span>
<span id="cb121-3"><a aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">sum_lo =</span> <span class="fu">sum</span>(lo_r, lo_f, lo_m),</span>
<span id="cb121-4"><a aria-hidden="true" tabindex="-1"></a>         <span class="at">sum_hi =</span> <span class="fu">sum</span>(hi_r, hi_f, hi_m)) <span class="sc">|&gt;</span></span>
<span id="cb121-5"><a aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(segment, sum_lo, sum_hi, <span class="fu">everything</span>())</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre data-code-line-numbers=""><code># A tibble: 11 × 10
# Groups:   segment [11]
   segment         sum_lo sum_hi  lo_r  hi_r  lo_f  hi_f  lo_m  hi_m description
   &lt;chr&gt;            &lt;int&gt;  &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;chr&gt;      
 1 Champions           12     15     4     5     4     5     4     5 Bought rec…
 2 Loyal Customers      8     15     2     5     3     5     3     5 Spend good…
 3 Potential Loya…      5     11     3     5     1     3     1     3 Recent cus…
 4 New Customers        4      7     4     5     0     1     0     1 Bought mor…
 5 Promising            3      6     3     4     0     1     0     1 Recent sho…
 6 Need Attention       6      9     2     3     2     3     2     3 Above aver…
 7 About To Sleep       2      7     2     3     0     2     0     2 Below aver…
 8 At Risk              4     12     0     2     2     5     2     5 Spent big …
 9 Can’t Lose Them      8     11     0     1     4     5     4     5 Made big p…
10 Hibernating          3      6     1     2     1     2     1     2 Low spende…
11 Lost                 0      6     0     2     0     2     0     2 Lowest rec…</code></pre>
</div>
</div>
</section></section>
<section>
<section id="foreign-formats" class="title-slide slide level1 inv-title center" data-background-color="#252F3E">
<h1>Foreign formats</h1>

</section>
<section class="slide level2">

<div class="huge">
<p><span class="fg-orange">What about Stata?</span></p>
</div>
</section>
<section id="using-haven" class="slide level2">
<h2>Using <span class="fg-green">haven</span></h2>
<ul>
<li>Haven is the Tidyverse’s package for reading and managing files from Stata, SPSS, and SAS. You should prefer it to the older Base R package <code>foreign</code>, which has similar functionality.</li>
<li>We’re going to import a General Social Survey dataset that’s in Stata’s <code>.dta</code> format.</li>
</ul>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb123" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb123-1"><a aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(haven)</span>
<span id="cb123-2"><a aria-hidden="true" tabindex="-1"></a></span>
<span id="cb123-3"><a aria-hidden="true" tabindex="-1"></a><span class="co"># This will take a moment</span></span>
<span id="cb123-4"><a aria-hidden="true" tabindex="-1"></a>gss_panel <span class="ot">&lt;-</span> <span class="fu">read_stata</span>(<span class="fu">here</span>(<span class="st">"data"</span>, <span class="st">"gss_panel_long.dta"</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div class="fragment" data-fragment-index="3">
<p>We’ll do some of the common recoding and reorganizing tasks that accompany this.</p>
</div>
</section>
<section id="the-gss-panel" class="slide level2">
<h2>The GSS panel</h2>
<ul>
<li>The data:</li>
</ul>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb124" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb124-1"><a aria-hidden="true" tabindex="-1"></a>gss_panel</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre data-code-line-numbers=""><code># A tibble: 14,610 × 2,757
   firstyear firstid    year    id vpsu   vstrat adults ballot  dateintv famgen 
       &lt;dbl&gt; &lt;dbl+lbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl+&gt; &lt;dbl+&gt; &lt;dbl+&gt; &lt;dbl+l&gt; &lt;dbl+lb&gt; &lt;dbl+l&gt;
 1      2006  9         2006     9     2  1957       1  3 [BAL… 709      1 [1 G…
 2      2006  9         2008  3001    NA    NA       2  3 [BAL… 503      1 [1 G…
 3      2006  9         2010  6001 NA(i)    NA       2  3 [BAL… 508      1 [1 G…
 4      2006 10         2010  6002 NA(i)    NA       1  1 [BAL… 408      1 [1 G…
 5      2006 10         2006    10     2  1957       2  1 [BAL… 630      2 [2 G…
 6      2006 10         2008  3002    NA    NA       2  1 [BAL… 426      2 [2 G…
 7      2006 11         2008  3003    NA    NA       2  3 [BAL… 718      4 [2 G…
 8      2006 11         2010  6003 NA(i)    NA   NA(n)  3 [BAL… 518      2 [2 G…
 9      2006 11         2006    11     2  1957       2  3 [BAL… 630      4 [2 G…
10      2006 12         2010  6004 NA(i)    NA       4  1 [BAL… 324      2 [2 G…
# ℹ 14,600 more rows
# ℹ 2,747 more variables: form &lt;dbl+lbl&gt;, formwt &lt;dbl&gt;, gender1 &lt;dbl+lbl&gt;,
#   hompop &lt;dbl+lbl&gt;, intage &lt;dbl+lbl&gt;, intid &lt;dbl+lbl&gt;, intyrs &lt;dbl+lbl&gt;,
#   mode &lt;dbl+lbl&gt;, oversamp &lt;dbl&gt;, phase &lt;dbl+lbl&gt;, race &lt;dbl+lbl&gt;,
#   reg16 &lt;dbl+lbl&gt;, region &lt;dbl+lbl&gt;, relate1 &lt;dbl+lbl&gt;, relhh1 &lt;dbl+lbl&gt;,
#   relhhd1 &lt;dbl+lbl&gt;, respnum &lt;dbl+lbl&gt;, rvisitor &lt;dbl+lbl&gt;,
#   sampcode &lt;dbl+lbl&gt;, sample &lt;dbl+lbl&gt;, sex &lt;dbl+lbl&gt;, size &lt;dbl+lbl&gt;, …</code></pre>
</div>
</div>
</section>
<section id="the-gss-panel-1" class="slide level2">
<h2>The GSS panel</h2>
<ul>
<li class="fragment">Many variables.</li>
<li class="fragment">Stata’s missing value types are preserved</li>
<li class="fragment">Data types are things like <code>dbl+lbl</code> indicating that Stata’s numeric values and variable labels have been preserved.</li>
</ul>
</section>
<section id="the-gss-panel-2" class="slide level2">
<h2>The GSS panel</h2>
<ul>
<li>You can see the labeling system at work:</li>
</ul>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb126" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb126-1"><a aria-hidden="true" tabindex="-1"></a>gss_panel <span class="sc">|&gt;</span> </span>
<span id="cb126-2"><a aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(degree) <span class="sc">|&gt;</span> </span>
<span id="cb126-3"><a aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(degree) <span class="sc">|&gt;</span> </span>
<span id="cb126-4"><a aria-hidden="true" tabindex="-1"></a>  <span class="fu">tally</span>()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre data-code-line-numbers=""><code># A tibble: 6 × 2
  degree                     n
  &lt;dbl+lbl&gt;              &lt;int&gt;
1     0 [LT HIGH SCHOOL]  1850
2     1 [HIGH SCHOOL]     7274
3     2 [JUNIOR COLLEGE]  1161
4     3 [bachelor]        2767
5     4 [graduate]        1556
6 NA(d)                      2</code></pre>
</div>
</div>
</section>
<section id="the-gss-panel-3" class="slide level2">
<h2>The GSS panel</h2>
<ul>
<li>Values get pivoted, not labels, though.</li>
</ul>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb128" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb128-1"><a aria-hidden="true" tabindex="-1"></a>gss_panel <span class="sc">|&gt;</span> </span>
<span id="cb128-2"><a aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(sex, degree) <span class="sc">|&gt;</span> </span>
<span id="cb128-3"><a aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(sex, degree) <span class="sc">|&gt;</span> </span>
<span id="cb128-4"><a aria-hidden="true" tabindex="-1"></a>  <span class="fu">tally</span>() <span class="sc">|&gt;</span> </span>
<span id="cb128-5"><a aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> sex, <span class="at">values_from =</span> n)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre data-code-line-numbers=""><code># A tibble: 6 × 3
  degree                   `1`   `2`
  &lt;dbl+lbl&gt;              &lt;int&gt; &lt;int&gt;
1     0 [LT HIGH SCHOOL]   814  1036
2     1 [HIGH SCHOOL]     3131  4143
3     2 [JUNIOR COLLEGE]   440   721
4     3 [bachelor]        1293  1474
5     4 [graduate]         696   860
6 NA(d)                     NA     2</code></pre>
</div>
</div>
</section>
<section id="the-gss-panel-4" class="slide level2">
<h2>The GSS panel</h2>
<ul>
<li>Option 1: Just drop all the labels.</li>
</ul>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb130" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb130-1"><a aria-hidden="true" tabindex="-1"></a>gss_panel <span class="sc">|&gt;</span> </span>
<span id="cb130-2"><a aria-hidden="true" tabindex="-1"></a>  <span class="fu">zap_missing</span>() <span class="sc">|&gt;</span> </span>
<span id="cb130-3"><a aria-hidden="true" tabindex="-1"></a>  <span class="fu">zap_labels</span>()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre data-code-line-numbers=""><code># A tibble: 14,610 × 2,757
   firstyear firstid  year    id  vpsu vstrat adults ballot dateintv famgen
       &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;    &lt;dbl&gt;  &lt;dbl&gt;
 1      2006       9  2006     9     2   1957      1      3      709      1
 2      2006       9  2008  3001    NA     NA      2      3      503      1
 3      2006       9  2010  6001    NA     NA      2      3      508      1
 4      2006      10  2010  6002    NA     NA      1      1      408      1
 5      2006      10  2006    10     2   1957      2      1      630      2
 6      2006      10  2008  3002    NA     NA      2      1      426      2
 7      2006      11  2008  3003    NA     NA      2      3      718      4
 8      2006      11  2010  6003    NA     NA     NA      3      518      2
 9      2006      11  2006    11     2   1957      2      3      630      4
10      2006      12  2010  6004    NA     NA      4      1      324      2
# ℹ 14,600 more rows
# ℹ 2,747 more variables: form &lt;dbl&gt;, formwt &lt;dbl&gt;, gender1 &lt;dbl&gt;,
#   hompop &lt;dbl&gt;, intage &lt;dbl&gt;, intid &lt;dbl&gt;, intyrs &lt;dbl&gt;, mode &lt;dbl&gt;,
#   oversamp &lt;dbl&gt;, phase &lt;dbl&gt;, race &lt;dbl&gt;, reg16 &lt;dbl&gt;, region &lt;dbl&gt;,
#   relate1 &lt;dbl&gt;, relhh1 &lt;dbl&gt;, relhhd1 &lt;dbl&gt;, respnum &lt;dbl&gt;, rvisitor &lt;dbl&gt;,
#   sampcode &lt;dbl&gt;, sample &lt;dbl&gt;, sex &lt;dbl&gt;, size &lt;dbl&gt;, spaneng &lt;dbl&gt;,
#   srcbelt &lt;dbl&gt;, version &lt;dbl&gt;, visitors &lt;dbl&gt;, wtss &lt;dbl&gt;, wtssall &lt;dbl&gt;, …</code></pre>
</div>
</div>
</section>
<section id="the-gss-panel-5" class="slide level2">
<h2>The GSS panel</h2>
<ul>
<li>Option 2: Convert the labels</li>
<li>Let’s focus on a few measures of interest, and do some recoding.</li>
</ul>
<div class="smallcode">
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb132" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb132-1"><a aria-hidden="true" tabindex="-1"></a><span class="do">## Categorical vars</span></span>
<span id="cb132-2"><a aria-hidden="true" tabindex="-1"></a>cat_vars <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"race"</span>, <span class="st">"sex"</span>, <span class="st">"degree"</span>, <span class="st">"relig"</span>, <span class="st">"income"</span>, <span class="st">"polviews"</span>, <span class="st">"fefam"</span>)</span>
<span id="cb132-3"><a aria-hidden="true" tabindex="-1"></a></span>
<span id="cb132-4"><a aria-hidden="true" tabindex="-1"></a><span class="do">## Integer vars</span></span>
<span id="cb132-5"><a aria-hidden="true" tabindex="-1"></a>int_vars <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"year"</span>, <span class="st">"id"</span>, <span class="st">"ballot"</span>, <span class="st">"age"</span>, <span class="st">"tvhours"</span>)</span>
<span id="cb132-6"><a aria-hidden="true" tabindex="-1"></a></span>
<span id="cb132-7"><a aria-hidden="true" tabindex="-1"></a></span>
<span id="cb132-8"><a aria-hidden="true" tabindex="-1"></a><span class="do">## Survey design</span></span>
<span id="cb132-9"><a aria-hidden="true" tabindex="-1"></a>wt_vars <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"vpsu"</span>,</span>
<span id="cb132-10"><a aria-hidden="true" tabindex="-1"></a>             <span class="st">"vstrat"</span>,</span>
<span id="cb132-11"><a aria-hidden="true" tabindex="-1"></a>             <span class="st">"oversamp"</span>,</span>
<span id="cb132-12"><a aria-hidden="true" tabindex="-1"></a>             <span class="st">"formwt"</span>,              <span class="co"># weight to deal with experimental randomization</span></span>
<span id="cb132-13"><a aria-hidden="true" tabindex="-1"></a>             <span class="st">"wtssall"</span>,             <span class="co"># weight variable</span></span>
<span id="cb132-14"><a aria-hidden="true" tabindex="-1"></a>             <span class="st">"sampcode"</span>,            <span class="co"># sampling error code</span></span>
<span id="cb132-15"><a aria-hidden="true" tabindex="-1"></a>             <span class="st">"sample"</span>)              <span class="co"># sampling frame and method</span></span>
<span id="cb132-16"><a aria-hidden="true" tabindex="-1"></a></span>
<span id="cb132-17"><a aria-hidden="true" tabindex="-1"></a></span>
<span id="cb132-18"><a aria-hidden="true" tabindex="-1"></a>my_gss_vars <span class="ot">&lt;-</span> <span class="fu">c</span>(int_vars, cat_vars, wt_vars)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</div>
</section>
<section id="cut-down-the-dataset" class="slide level2">
<h2>Cut down the dataset</h2>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb133" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb133-1"><a aria-hidden="true" tabindex="-1"></a>gss_sub <span class="ot">&lt;-</span> gss_panel <span class="sc">|&gt;</span> </span>
<span id="cb133-2"><a aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">all_of</span>(my_gss_vars))</span>
<span id="cb133-3"><a aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-4"><a aria-hidden="true" tabindex="-1"></a>gss_sub</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre data-code-line-numbers=""><code># A tibble: 14,610 × 19
    year    id ballot       age      tvhours     race    sex     degree  relig  
   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl+lbl&gt;    &lt;dbl+lb&gt; &lt;dbl+lbl&gt;   &lt;dbl+l&gt; &lt;dbl+l&gt; &lt;dbl+l&gt; &lt;dbl+l&gt;
 1  2006     9 3 [BALLOT C] 23       NA(a) [iap] 2 [bla… 2 [fem… 3 [bac… 4 [non…
 2  2008  3001 3 [BALLOT C] 25       NA(i)       3 [oth… 2 [fem… 3 [bac… 4 [non…
 3  2010  6001 3 [BALLOT C] 27       NA(i)       2 [bla… 2 [fem… 3 [bac… 4 [non…
 4  2010  6002 1 [BALLOT A] 36           3       1 [whi… 2 [fem… 4 [gra… 4 [non…
 5  2006    10 1 [BALLOT A] 32           3       3 [oth… 2 [fem… 4 [gra… 4 [non…
 6  2008  3002 1 [BALLOT A] 34           3       3 [oth… 2 [fem… 4 [gra… 4 [non…
 7  2008  3003 3 [BALLOT C] 83       NA(i)       2 [bla… 2 [fem… 0 [LT … 1 [pro…
 8  2010  6003 3 [BALLOT C] 85       NA(i)       2 [bla… 2 [fem… 0 [LT … 1 [pro…
 9  2006    11 3 [BALLOT C] 81       NA(a) [iap] 2 [bla… 2 [fem… 0 [LT … 1 [pro…
10  2010  6004 1 [BALLOT A] 51          10       3 [oth… 1 [mal… 1 [HIG… 2 [cat…
# ℹ 14,600 more rows
# ℹ 10 more variables: income &lt;dbl+lbl&gt;, polviews &lt;dbl+lbl&gt;, fefam &lt;dbl+lbl&gt;,
#   vpsu &lt;dbl+lbl&gt;, vstrat &lt;dbl+lbl&gt;, oversamp &lt;dbl&gt;, formwt &lt;dbl&gt;,
#   wtssall &lt;dbl+lbl&gt;, sampcode &lt;dbl+lbl&gt;, sample &lt;dbl+lbl&gt;</code></pre>
</div>
</div>
</section>
<section id="the-gss-panel-recoding" class="slide level2">
<h2>The GSS Panel: Recoding</h2>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb135" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb135-1"><a aria-hidden="true" tabindex="-1"></a>gss_sub <span class="sc">|&gt;</span> </span>
<span id="cb135-2"><a aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">everything</span>(), zap_missing)) <span class="sc">|&gt;</span> </span>
<span id="cb135-3"><a aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">all_of</span>(wt_vars), as.numeric)) <span class="sc">|&gt;</span> </span>
<span id="cb135-4"><a aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">all_of</span>(int_vars), as.integer)) <span class="sc">|&gt;</span> </span>
<span id="cb135-5"><a aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">all_of</span>(cat_vars), as_factor)) <span class="sc">|&gt;</span></span>
<span id="cb135-6"><a aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">all_of</span>(cat_vars), fct_relabel, tolower)) <span class="sc">|&gt;</span> </span>
<span id="cb135-7"><a aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">all_of</span>(cat_vars), fct_relabel, tools<span class="sc">::</span>toTitleCase)) <span class="sc">|&gt;</span> </span>
<span id="cb135-8"><a aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">income =</span> <span class="fu">str_replace</span>(income, <span class="st">" - "</span>, <span class="st">"-"</span>)) </span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre data-code-line-numbers=""><code># A tibble: 14,610 × 19
    year    id ballot   age tvhours race  sex    degree    relig income polviews
   &lt;int&gt; &lt;int&gt;  &lt;int&gt; &lt;int&gt;   &lt;int&gt; &lt;fct&gt; &lt;fct&gt;  &lt;fct&gt;     &lt;fct&gt; &lt;chr&gt;  &lt;fct&gt;   
 1  2006     9      3    23      NA Black Female Bachelor  None  $2500… Conserv…
 2  2008  3001      3    25      NA Other Female Bachelor  None  $2500… Extreme…
 3  2010  6001      3    27      NA Black Female Bachelor  None  $2500… Extreme…
 4  2010  6002      1    36       3 White Female Graduate  None  $2500… Liberal 
 5  2006    10      1    32       3 Other Female Graduate  None  &lt;NA&gt;   Slightl…
 6  2008  3002      1    34       3 Other Female Graduate  None  $2500… Moderate
 7  2008  3003      3    83      NA Black Female Lt High … Prot… $2000… Liberal 
 8  2010  6003      3    85      NA Black Female Lt High … Prot… &lt;NA&gt;   Moderate
 9  2006    11      3    81      NA Black Female Lt High … Prot… &lt;NA&gt;   Moderate
10  2010  6004      1    51      10 Other Male   High Sch… Cath… Lt $1… Liberal 
# ℹ 14,600 more rows
# ℹ 8 more variables: fefam &lt;fct&gt;, vpsu &lt;dbl&gt;, vstrat &lt;dbl&gt;, oversamp &lt;dbl&gt;,
#   formwt &lt;dbl&gt;, wtssall &lt;dbl&gt;, sampcode &lt;dbl&gt;, sample &lt;dbl&gt;</code></pre>
</div>
</div>
</section>
<section id="how-wed-actually-write-this" class="slide level2">
<h2>How we’d actually write this</h2>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb137" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb137-1"><a aria-hidden="true" tabindex="-1"></a>gss_sub <span class="ot">&lt;-</span> gss_sub <span class="sc">|&gt;</span> </span>
<span id="cb137-2"><a aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">everything</span>(), zap_missing), </span>
<span id="cb137-3"><a aria-hidden="true" tabindex="-1"></a>         <span class="fu">across</span>(<span class="fu">all_of</span>(wt_vars), as.numeric), </span>
<span id="cb137-4"><a aria-hidden="true" tabindex="-1"></a>         <span class="fu">across</span>(<span class="fu">all_of</span>(int_vars), as.integer), </span>
<span id="cb137-5"><a aria-hidden="true" tabindex="-1"></a>         <span class="fu">across</span>(<span class="fu">all_of</span>(cat_vars), as_factor),</span>
<span id="cb137-6"><a aria-hidden="true" tabindex="-1"></a>         <span class="fu">across</span>(<span class="fu">all_of</span>(cat_vars), fct_relabel, tolower), </span>
<span id="cb137-7"><a aria-hidden="true" tabindex="-1"></a>         <span class="fu">across</span>(<span class="fu">all_of</span>(cat_vars), fct_relabel, tools<span class="sc">::</span>toTitleCase), </span>
<span id="cb137-8"><a aria-hidden="true" tabindex="-1"></a>         <span class="at">income =</span> <span class="fu">str_replace</span>(income, <span class="st">" - "</span>, <span class="st">"-"</span>)) </span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="the-gss-panel-more-recoding" class="slide level2">
<h2>The GSS panel: more recoding</h2>
<ul>
<li>Age quintiles: find the cutpoints</li>
</ul>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb138" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb138-1"><a aria-hidden="true" tabindex="-1"></a><span class="co"># seq can make all kinds of sequences</span></span>
<span id="cb138-2"><a aria-hidden="true" tabindex="-1"></a><span class="fu">seq</span>(<span class="at">from =</span> <span class="dv">0</span>, <span class="at">to =</span> <span class="dv">1</span>, <span class="at">by =</span> <span class="fl">0.2</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre data-code-line-numbers=""><code>[1] 0.0 0.2 0.4 0.6 0.8 1.0</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb140" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb140-1"><a aria-hidden="true" tabindex="-1"></a>age_quintiles <span class="ot">&lt;-</span> <span class="fu">quantile</span>(<span class="fu">as.numeric</span>(gss_panel<span class="sc">$</span>age), </span>
<span id="cb140-2"><a aria-hidden="true" tabindex="-1"></a>                      <span class="at">probs =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="fl">0.2</span>), </span>
<span id="cb140-3"><a aria-hidden="true" tabindex="-1"></a>                      <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb140-4"><a aria-hidden="true" tabindex="-1"></a></span>
<span id="cb140-5"><a aria-hidden="true" tabindex="-1"></a><span class="do">## These are the quintile cutpoints</span></span>
<span id="cb140-6"><a aria-hidden="true" tabindex="-1"></a>age_quintiles</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre data-code-line-numbers=""><code>  0%  20%  40%  60%  80% 100% 
  18   33   43   53   65   89 </code></pre>
</div>
</div>
</section>
<section id="the-gss-panel-more-recoding-1" class="slide level2">
<h2>The GSS panel: more recoding</h2>
<ul>
<li>Age quintiles: create the quintile variable</li>
</ul>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb142" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb142-1"><a aria-hidden="true" tabindex="-1"></a><span class="do">## Apply the cut</span></span>
<span id="cb142-2"><a aria-hidden="true" tabindex="-1"></a>gss_sub <span class="sc">|&gt;</span> </span>
<span id="cb142-3"><a aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">agequint =</span> <span class="fu">cut</span>(<span class="at">x =</span> age, </span>
<span id="cb142-4"><a aria-hidden="true" tabindex="-1"></a>                          <span class="at">breaks =</span> <span class="fu">unique</span>(age_quintiles), </span>
<span id="cb142-5"><a aria-hidden="true" tabindex="-1"></a>                          <span class="at">include.lowest =</span> <span class="cn">TRUE</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb142-6"><a aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(agequint) <span class="sc">|&gt;</span> <span class="co"># grab a column and make it an ordinary vector</span></span>
<span id="cb142-7"><a aria-hidden="true" tabindex="-1"></a>  <span class="fu">table</span>()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre data-code-line-numbers=""><code>
[18,33] (33,43] (43,53] (53,65] (65,89] 
   3157    2680    2851    3057    2720 </code></pre>
</div>
</div>
<ul>
<li>We’ll need to clean up those labels.</li>
</ul>
</section>
<section id="the-gss-panel-more-recoding-2" class="slide level2">
<h2>The GSS panel: more recoding</h2>
<ul>
<li>I told you that regexp stuff would pay off.</li>
</ul>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb144" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb144-1"><a aria-hidden="true" tabindex="-1"></a>convert_agegrp <span class="ot">&lt;-</span> <span class="cf">function</span>(x){</span>
<span id="cb144-2"><a aria-hidden="true" tabindex="-1"></a>    x <span class="ot">&lt;-</span> stringr<span class="sc">::</span><span class="fu">str_remove</span>(x, <span class="st">"</span><span class="sc">\\</span><span class="st">("</span>)  <span class="co"># Remove open paren</span></span>
<span id="cb144-3"><a aria-hidden="true" tabindex="-1"></a>    x <span class="ot">&lt;-</span> stringr<span class="sc">::</span><span class="fu">str_remove</span>(x, <span class="st">"</span><span class="sc">\\</span><span class="st">["</span>)  <span class="co"># Remove open bracket</span></span>
<span id="cb144-4"><a aria-hidden="true" tabindex="-1"></a>    x <span class="ot">&lt;-</span> stringr<span class="sc">::</span><span class="fu">str_remove</span>(x, <span class="st">"</span><span class="sc">\\</span><span class="st">]"</span>)  <span class="co"># Remove close bracket</span></span>
<span id="cb144-5"><a aria-hidden="true" tabindex="-1"></a>    x <span class="ot">&lt;-</span> stringr<span class="sc">::</span><span class="fu">str_replace</span>(x, <span class="st">","</span>, <span class="st">"-"</span>) <span class="co"># Replace comma with dash</span></span>
<span id="cb144-6"><a aria-hidden="true" tabindex="-1"></a>    x <span class="ot">&lt;-</span> stringr<span class="sc">::</span><span class="fu">str_replace</span>(x, <span class="st">"-89"</span>, <span class="st">"+"</span>) <span class="co"># Replace -89 with + </span></span>
<span id="cb144-7"><a aria-hidden="true" tabindex="-1"></a>    regex <span class="ot">&lt;-</span> <span class="st">"^(.*$)"</span> <span class="co"># Matches everything in string to end of line</span></span>
<span id="cb144-8"><a aria-hidden="true" tabindex="-1"></a>    x <span class="ot">&lt;-</span> stringr<span class="sc">::</span><span class="fu">str_replace</span>(x, regex, <span class="st">"Age </span><span class="sc">\\</span><span class="st">1"</span>) <span class="co"># Preface string with "Age" </span></span>
<span id="cb144-9"><a aria-hidden="true" tabindex="-1"></a>    x</span>
<span id="cb144-10"><a aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="the-gss-panel-more-recoding-3" class="slide level2">
<h2>The GSS panel: more recoding</h2>
<div class="columns smallcode">
<div class="column" style="width:40%;">
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb145" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb145-1"><a aria-hidden="true" tabindex="-1"></a>gss_sub</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</div><div class="column" style="width:60%;">
<div class="cell" data-layout-align="center">
<div class="cell-output cell-output-stdout">
<pre data-code-line-numbers=""><code># A tibble: 14,610 × 19
    year    id ballot   age tvhours race  sex    degree    relig income polviews
   &lt;int&gt; &lt;int&gt;  &lt;int&gt; &lt;int&gt;   &lt;int&gt; &lt;fct&gt; &lt;fct&gt;  &lt;fct&gt;     &lt;fct&gt; &lt;chr&gt;  &lt;fct&gt;   
 1  2006     9      3    23      NA Black Female Bachelor  None  $2500… Conserv…
 2  2008  3001      3    25      NA Other Female Bachelor  None  $2500… Extreme…
 3  2010  6001      3    27      NA Black Female Bachelor  None  $2500… Extreme…
 4  2010  6002      1    36       3 White Female Graduate  None  $2500… Liberal 
 5  2006    10      1    32       3 Other Female Graduate  None  &lt;NA&gt;   Slightl…
 6  2008  3002      1    34       3 Other Female Graduate  None  $2500… Moderate
 7  2008  3003      3    83      NA Black Female Lt High … Prot… $2000… Liberal 
 8  2010  6003      3    85      NA Black Female Lt High … Prot… &lt;NA&gt;   Moderate
 9  2006    11      3    81      NA Black Female Lt High … Prot… &lt;NA&gt;   Moderate
10  2010  6004      1    51      10 Other Male   High Sch… Cath… Lt $1… Liberal 
# ℹ 14,600 more rows
# ℹ 8 more variables: fefam &lt;fct&gt;, vpsu &lt;dbl&gt;, vstrat &lt;dbl&gt;, oversamp &lt;dbl&gt;,
#   formwt &lt;dbl&gt;, wtssall &lt;dbl&gt;, sampcode &lt;dbl&gt;, sample &lt;dbl&gt;</code></pre>
</div>
</div>
</div></div>
</section>
<section id="the-gss-panel-more-recoding-4" class="slide level2">
<h2>The GSS panel: more recoding</h2>
<div class="columns smallcode">
<div class="column" style="width:40%;">
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb147" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb147-1"><a aria-hidden="true" tabindex="-1"></a>gss_sub <span class="sc">|&gt;</span></span>
<span id="cb147-2"><a aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">agequint =</span> <span class="fu">cut</span>(<span class="at">x =</span> age,</span>
<span id="cb147-3"><a aria-hidden="true" tabindex="-1"></a>                          <span class="at">breaks =</span> <span class="fu">unique</span>(age_quintiles),</span>
<span id="cb147-4"><a aria-hidden="true" tabindex="-1"></a>                          <span class="at">include.lowest =</span> <span class="cn">TRUE</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</div><div class="column" style="width:60%;">
<div class="cell" data-layout-align="center">
<div class="cell-output cell-output-stdout">
<pre data-code-line-numbers=""><code># A tibble: 14,610 × 20
    year    id ballot   age tvhours race  sex    degree    relig income polviews
   &lt;int&gt; &lt;int&gt;  &lt;int&gt; &lt;int&gt;   &lt;int&gt; &lt;fct&gt; &lt;fct&gt;  &lt;fct&gt;     &lt;fct&gt; &lt;chr&gt;  &lt;fct&gt;   
 1  2006     9      3    23      NA Black Female Bachelor  None  $2500… Conserv…
 2  2008  3001      3    25      NA Other Female Bachelor  None  $2500… Extreme…
 3  2010  6001      3    27      NA Black Female Bachelor  None  $2500… Extreme…
 4  2010  6002      1    36       3 White Female Graduate  None  $2500… Liberal 
 5  2006    10      1    32       3 Other Female Graduate  None  &lt;NA&gt;   Slightl…
 6  2008  3002      1    34       3 Other Female Graduate  None  $2500… Moderate
 7  2008  3003      3    83      NA Black Female Lt High … Prot… $2000… Liberal 
 8  2010  6003      3    85      NA Black Female Lt High … Prot… &lt;NA&gt;   Moderate
 9  2006    11      3    81      NA Black Female Lt High … Prot… &lt;NA&gt;   Moderate
10  2010  6004      1    51      10 Other Male   High Sch… Cath… Lt $1… Liberal 
# ℹ 14,600 more rows
# ℹ 9 more variables: fefam &lt;fct&gt;, vpsu &lt;dbl&gt;, vstrat &lt;dbl&gt;, oversamp &lt;dbl&gt;,
#   formwt &lt;dbl&gt;, wtssall &lt;dbl&gt;, sampcode &lt;dbl&gt;, sample &lt;dbl&gt;, agequint &lt;fct&gt;</code></pre>
</div>
</div>
</div></div>
</section>
<section id="the-gss-panel-more-recoding-5" class="slide level2">
<h2>The GSS panel: more recoding</h2>
<div class="columns smallcode">
<div class="column" style="width:40%;">
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb149" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb149-1"><a aria-hidden="true" tabindex="-1"></a>gss_sub <span class="sc">|&gt;</span></span>
<span id="cb149-2"><a aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">agequint =</span> <span class="fu">cut</span>(<span class="at">x =</span> age,</span>
<span id="cb149-3"><a aria-hidden="true" tabindex="-1"></a>                          <span class="at">breaks =</span> <span class="fu">unique</span>(age_quintiles),</span>
<span id="cb149-4"><a aria-hidden="true" tabindex="-1"></a>                          <span class="at">include.lowest =</span> <span class="cn">TRUE</span>)) <span class="sc">|&gt;</span></span>
<span id="cb149-5"><a aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">agequint =</span> <span class="fu">fct_relabel</span>(agequint, convert_agegrp))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</div><div class="column" style="width:60%;">
<div class="cell" data-layout-align="center">
<div class="cell-output cell-output-stdout">
<pre data-code-line-numbers=""><code># A tibble: 14,610 × 20
    year    id ballot   age tvhours race  sex    degree    relig income polviews
   &lt;int&gt; &lt;int&gt;  &lt;int&gt; &lt;int&gt;   &lt;int&gt; &lt;fct&gt; &lt;fct&gt;  &lt;fct&gt;     &lt;fct&gt; &lt;chr&gt;  &lt;fct&gt;   
 1  2006     9      3    23      NA Black Female Bachelor  None  $2500… Conserv…
 2  2008  3001      3    25      NA Other Female Bachelor  None  $2500… Extreme…
 3  2010  6001      3    27      NA Black Female Bachelor  None  $2500… Extreme…
 4  2010  6002      1    36       3 White Female Graduate  None  $2500… Liberal 
 5  2006    10      1    32       3 Other Female Graduate  None  &lt;NA&gt;   Slightl…
 6  2008  3002      1    34       3 Other Female Graduate  None  $2500… Moderate
 7  2008  3003      3    83      NA Black Female Lt High … Prot… $2000… Liberal 
 8  2010  6003      3    85      NA Black Female Lt High … Prot… &lt;NA&gt;   Moderate
 9  2006    11      3    81      NA Black Female Lt High … Prot… &lt;NA&gt;   Moderate
10  2010  6004      1    51      10 Other Male   High Sch… Cath… Lt $1… Liberal 
# ℹ 14,600 more rows
# ℹ 9 more variables: fefam &lt;fct&gt;, vpsu &lt;dbl&gt;, vstrat &lt;dbl&gt;, oversamp &lt;dbl&gt;,
#   formwt &lt;dbl&gt;, wtssall &lt;dbl&gt;, sampcode &lt;dbl&gt;, sample &lt;dbl&gt;, agequint &lt;fct&gt;</code></pre>
</div>
</div>
</div></div>
</section>
<section id="the-gss-panel-more-recoding-6" class="slide level2">
<h2>The GSS panel: more recoding</h2>
<div class="columns smallcode">
<div class="column" style="width:40%;">
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb151" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb151-1"><a aria-hidden="true" tabindex="-1"></a>gss_sub <span class="sc">|&gt;</span></span>
<span id="cb151-2"><a aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">agequint =</span> <span class="fu">cut</span>(<span class="at">x =</span> age,</span>
<span id="cb151-3"><a aria-hidden="true" tabindex="-1"></a>                          <span class="at">breaks =</span> <span class="fu">unique</span>(age_quintiles),</span>
<span id="cb151-4"><a aria-hidden="true" tabindex="-1"></a>                          <span class="at">include.lowest =</span> <span class="cn">TRUE</span>)) <span class="sc">|&gt;</span></span>
<span id="cb151-5"><a aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">agequint =</span> <span class="fu">fct_relabel</span>(agequint, convert_agegrp)) <span class="sc">|&gt;</span></span>
<span id="cb151-6"><a aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">year_f =</span> <span class="fu">droplevels</span>(<span class="fu">factor</span>(year)))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</div><div class="column" style="width:60%;">
<div class="cell" data-layout-align="center">
<div class="cell-output cell-output-stdout">
<pre data-code-line-numbers=""><code># A tibble: 14,610 × 21
    year    id ballot   age tvhours race  sex    degree    relig income polviews
   &lt;int&gt; &lt;int&gt;  &lt;int&gt; &lt;int&gt;   &lt;int&gt; &lt;fct&gt; &lt;fct&gt;  &lt;fct&gt;     &lt;fct&gt; &lt;chr&gt;  &lt;fct&gt;   
 1  2006     9      3    23      NA Black Female Bachelor  None  $2500… Conserv…
 2  2008  3001      3    25      NA Other Female Bachelor  None  $2500… Extreme…
 3  2010  6001      3    27      NA Black Female Bachelor  None  $2500… Extreme…
 4  2010  6002      1    36       3 White Female Graduate  None  $2500… Liberal 
 5  2006    10      1    32       3 Other Female Graduate  None  &lt;NA&gt;   Slightl…
 6  2008  3002      1    34       3 Other Female Graduate  None  $2500… Moderate
 7  2008  3003      3    83      NA Black Female Lt High … Prot… $2000… Liberal 
 8  2010  6003      3    85      NA Black Female Lt High … Prot… &lt;NA&gt;   Moderate
 9  2006    11      3    81      NA Black Female Lt High … Prot… &lt;NA&gt;   Moderate
10  2010  6004      1    51      10 Other Male   High Sch… Cath… Lt $1… Liberal 
# ℹ 14,600 more rows
# ℹ 10 more variables: fefam &lt;fct&gt;, vpsu &lt;dbl&gt;, vstrat &lt;dbl&gt;, oversamp &lt;dbl&gt;,
#   formwt &lt;dbl&gt;, wtssall &lt;dbl&gt;, sampcode &lt;dbl&gt;, sample &lt;dbl&gt;, agequint &lt;fct&gt;,
#   year_f &lt;fct&gt;</code></pre>
</div>
</div>
</div></div>
</section>
<section id="the-gss-panel-more-recoding-7" class="slide level2">
<h2>The GSS panel: more recoding</h2>
<div class="columns smallcode">
<div class="column" style="width:40%;">
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb153" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb153-1"><a aria-hidden="true" tabindex="-1"></a>gss_sub <span class="sc">|&gt;</span></span>
<span id="cb153-2"><a aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">agequint =</span> <span class="fu">cut</span>(<span class="at">x =</span> age,</span>
<span id="cb153-3"><a aria-hidden="true" tabindex="-1"></a>                          <span class="at">breaks =</span> <span class="fu">unique</span>(age_quintiles),</span>
<span id="cb153-4"><a aria-hidden="true" tabindex="-1"></a>                          <span class="at">include.lowest =</span> <span class="cn">TRUE</span>)) <span class="sc">|&gt;</span></span>
<span id="cb153-5"><a aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">agequint =</span> <span class="fu">fct_relabel</span>(agequint, convert_agegrp)) <span class="sc">|&gt;</span></span>
<span id="cb153-6"><a aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">year_f =</span> <span class="fu">droplevels</span>(<span class="fu">factor</span>(year))) <span class="sc">|&gt;</span></span>
<span id="cb153-7"><a aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">young =</span> <span class="fu">ifelse</span>(age <span class="sc">&lt;</span> <span class="dv">26</span>, <span class="st">"Yes"</span>, <span class="st">"No"</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</div><div class="column" style="width:60%;">
<div class="cell" data-layout-align="center">
<div class="cell-output cell-output-stdout">
<pre data-code-line-numbers=""><code># A tibble: 14,610 × 22
    year    id ballot   age tvhours race  sex    degree    relig income polviews
   &lt;int&gt; &lt;int&gt;  &lt;int&gt; &lt;int&gt;   &lt;int&gt; &lt;fct&gt; &lt;fct&gt;  &lt;fct&gt;     &lt;fct&gt; &lt;chr&gt;  &lt;fct&gt;   
 1  2006     9      3    23      NA Black Female Bachelor  None  $2500… Conserv…
 2  2008  3001      3    25      NA Other Female Bachelor  None  $2500… Extreme…
 3  2010  6001      3    27      NA Black Female Bachelor  None  $2500… Extreme…
 4  2010  6002      1    36       3 White Female Graduate  None  $2500… Liberal 
 5  2006    10      1    32       3 Other Female Graduate  None  &lt;NA&gt;   Slightl…
 6  2008  3002      1    34       3 Other Female Graduate  None  $2500… Moderate
 7  2008  3003      3    83      NA Black Female Lt High … Prot… $2000… Liberal 
 8  2010  6003      3    85      NA Black Female Lt High … Prot… &lt;NA&gt;   Moderate
 9  2006    11      3    81      NA Black Female Lt High … Prot… &lt;NA&gt;   Moderate
10  2010  6004      1    51      10 Other Male   High Sch… Cath… Lt $1… Liberal 
# ℹ 14,600 more rows
# ℹ 11 more variables: fefam &lt;fct&gt;, vpsu &lt;dbl&gt;, vstrat &lt;dbl&gt;, oversamp &lt;dbl&gt;,
#   formwt &lt;dbl&gt;, wtssall &lt;dbl&gt;, sampcode &lt;dbl&gt;, sample &lt;dbl&gt;, agequint &lt;fct&gt;,
#   year_f &lt;fct&gt;, young &lt;chr&gt;</code></pre>
</div>
</div>
</div></div>
</section>
<section id="the-gss-panel-more-recoding-8" class="slide level2">
<h2>The GSS panel: more recoding</h2>
<div class="columns smallcode">
<div class="column" style="width:40%;">
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb155" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb155-1"><a aria-hidden="true" tabindex="-1"></a>gss_sub <span class="sc">|&gt;</span></span>
<span id="cb155-2"><a aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">agequint =</span> <span class="fu">cut</span>(<span class="at">x =</span> age,</span>
<span id="cb155-3"><a aria-hidden="true" tabindex="-1"></a>                          <span class="at">breaks =</span> <span class="fu">unique</span>(age_quintiles),</span>
<span id="cb155-4"><a aria-hidden="true" tabindex="-1"></a>                          <span class="at">include.lowest =</span> <span class="cn">TRUE</span>)) <span class="sc">|&gt;</span></span>
<span id="cb155-5"><a aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">agequint =</span> <span class="fu">fct_relabel</span>(agequint, convert_agegrp)) <span class="sc">|&gt;</span></span>
<span id="cb155-6"><a aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">year_f =</span> <span class="fu">droplevels</span>(<span class="fu">factor</span>(year))) <span class="sc">|&gt;</span></span>
<span id="cb155-7"><a aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">young =</span> <span class="fu">ifelse</span>(age <span class="sc">&lt;</span> <span class="dv">26</span>, <span class="st">"Yes"</span>, <span class="st">"No"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb155-8"><a aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">fefam_d =</span> <span class="fu">fct_recode</span>(fefam,</span>
<span id="cb155-9"><a aria-hidden="true" tabindex="-1"></a>                                <span class="at">Agree =</span> <span class="st">"Strongly Agree"</span>,</span>
<span id="cb155-10"><a aria-hidden="true" tabindex="-1"></a>                                <span class="at">Disagree =</span> <span class="st">"Strongly Disagree"</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</div><div class="column" style="width:60%;">
<div class="cell" data-layout-align="center">
<div class="cell-output cell-output-stdout">
<pre data-code-line-numbers=""><code># A tibble: 14,610 × 23
    year    id ballot   age tvhours race  sex    degree    relig income polviews
   &lt;int&gt; &lt;int&gt;  &lt;int&gt; &lt;int&gt;   &lt;int&gt; &lt;fct&gt; &lt;fct&gt;  &lt;fct&gt;     &lt;fct&gt; &lt;chr&gt;  &lt;fct&gt;   
 1  2006     9      3    23      NA Black Female Bachelor  None  $2500… Conserv…
 2  2008  3001      3    25      NA Other Female Bachelor  None  $2500… Extreme…
 3  2010  6001      3    27      NA Black Female Bachelor  None  $2500… Extreme…
 4  2010  6002      1    36       3 White Female Graduate  None  $2500… Liberal 
 5  2006    10      1    32       3 Other Female Graduate  None  &lt;NA&gt;   Slightl…
 6  2008  3002      1    34       3 Other Female Graduate  None  $2500… Moderate
 7  2008  3003      3    83      NA Black Female Lt High … Prot… $2000… Liberal 
 8  2010  6003      3    85      NA Black Female Lt High … Prot… &lt;NA&gt;   Moderate
 9  2006    11      3    81      NA Black Female Lt High … Prot… &lt;NA&gt;   Moderate
10  2010  6004      1    51      10 Other Male   High Sch… Cath… Lt $1… Liberal 
# ℹ 14,600 more rows
# ℹ 12 more variables: fefam &lt;fct&gt;, vpsu &lt;dbl&gt;, vstrat &lt;dbl&gt;, oversamp &lt;dbl&gt;,
#   formwt &lt;dbl&gt;, wtssall &lt;dbl&gt;, sampcode &lt;dbl&gt;, sample &lt;dbl&gt;, agequint &lt;fct&gt;,
#   year_f &lt;fct&gt;, young &lt;chr&gt;, fefam_d &lt;fct&gt;</code></pre>
</div>
</div>
</div></div>
</section>
<section id="the-gss-panel-more-recoding-9" class="slide level2">
<h2>The GSS panel: more recoding</h2>
<div class="columns smallcode">
<div class="column" style="width:40%;">
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb157" data-source-line-numbers="nil" data-code-line-numbers="12,13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb157-1"><a aria-hidden="true" tabindex="-1"></a>gss_sub <span class="sc">|&gt;</span></span>
<span id="cb157-2"><a aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">agequint =</span> <span class="fu">cut</span>(<span class="at">x =</span> age,</span>
<span id="cb157-3"><a aria-hidden="true" tabindex="-1"></a>                          <span class="at">breaks =</span> <span class="fu">unique</span>(age_quintiles),</span>
<span id="cb157-4"><a aria-hidden="true" tabindex="-1"></a>                          <span class="at">include.lowest =</span> <span class="cn">TRUE</span>)) <span class="sc">|&gt;</span></span>
<span id="cb157-5"><a aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">agequint =</span> <span class="fu">fct_relabel</span>(agequint, convert_agegrp)) <span class="sc">|&gt;</span></span>
<span id="cb157-6"><a aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">year_f =</span> <span class="fu">droplevels</span>(<span class="fu">factor</span>(year))) <span class="sc">|&gt;</span></span>
<span id="cb157-7"><a aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">young =</span> <span class="fu">ifelse</span>(age <span class="sc">&lt;</span> <span class="dv">26</span>, <span class="st">"Yes"</span>, <span class="st">"No"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb157-8"><a aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">fefam_d =</span> <span class="fu">fct_recode</span>(fefam,</span>
<span id="cb157-9"><a aria-hidden="true" tabindex="-1"></a>                                <span class="at">Agree =</span> <span class="st">"Strongly Agree"</span>,</span>
<span id="cb157-10"><a aria-hidden="true" tabindex="-1"></a>                                <span class="at">Disagree =</span> <span class="st">"Strongly Disagree"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb157-11"><a aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">degree =</span> <span class="fu">factor</span>(degree,</span>
<span id="cb157-12"><a aria-hidden="true" tabindex="-1"></a>                           <span class="at">levels =</span> <span class="fu">levels</span>(gss_sub<span class="sc">$</span>degree),  </span>
<span id="cb157-13"><a aria-hidden="true" tabindex="-1"></a>                           <span class="at">ordered =</span> <span class="cn">TRUE</span>))  </span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</div><div class="column" style="width:60%;">
<div class="cell" data-layout-align="center">
<div class="cell-output cell-output-stdout">
<pre data-code-line-numbers=""><code># A tibble: 14,610 × 23
    year    id ballot   age tvhours race  sex    degree    relig income polviews
   &lt;int&gt; &lt;int&gt;  &lt;int&gt; &lt;int&gt;   &lt;int&gt; &lt;fct&gt; &lt;fct&gt;  &lt;ord&gt;     &lt;fct&gt; &lt;chr&gt;  &lt;fct&gt;   
 1  2006     9      3    23      NA Black Female Bachelor  None  $2500… Conserv…
 2  2008  3001      3    25      NA Other Female Bachelor  None  $2500… Extreme…
 3  2010  6001      3    27      NA Black Female Bachelor  None  $2500… Extreme…
 4  2010  6002      1    36       3 White Female Graduate  None  $2500… Liberal 
 5  2006    10      1    32       3 Other Female Graduate  None  &lt;NA&gt;   Slightl…
 6  2008  3002      1    34       3 Other Female Graduate  None  $2500… Moderate
 7  2008  3003      3    83      NA Black Female Lt High … Prot… $2000… Liberal 
 8  2010  6003      3    85      NA Black Female Lt High … Prot… &lt;NA&gt;   Moderate
 9  2006    11      3    81      NA Black Female Lt High … Prot… &lt;NA&gt;   Moderate
10  2010  6004      1    51      10 Other Male   High Sch… Cath… Lt $1… Liberal 
# ℹ 14,600 more rows
# ℹ 12 more variables: fefam &lt;fct&gt;, vpsu &lt;dbl&gt;, vstrat &lt;dbl&gt;, oversamp &lt;dbl&gt;,
#   formwt &lt;dbl&gt;, wtssall &lt;dbl&gt;, sampcode &lt;dbl&gt;, sample &lt;dbl&gt;, agequint &lt;fct&gt;,
#   year_f &lt;fct&gt;, young &lt;chr&gt;, fefam_d &lt;fct&gt;</code></pre>
</div>
</div>
</div></div>
</section>
<section id="how-wed-actually-write-this-1" class="slide level2">
<h2>How we’d actually write this</h2>
<div class="smallcode">
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb159" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb159-1"><a aria-hidden="true" tabindex="-1"></a>gss_sub <span class="ot">&lt;-</span> gss_sub <span class="sc">|&gt;</span></span>
<span id="cb159-2"><a aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(<span class="at">agequint =</span> <span class="fu">cut</span>(<span class="at">x =</span> age, </span>
<span id="cb159-3"><a aria-hidden="true" tabindex="-1"></a>                            <span class="at">breaks =</span> <span class="fu">unique</span>(age_quintiles), </span>
<span id="cb159-4"><a aria-hidden="true" tabindex="-1"></a>                            <span class="at">include.lowest =</span> <span class="cn">TRUE</span>), </span>
<span id="cb159-5"><a aria-hidden="true" tabindex="-1"></a>              <span class="at">agequint =</span> <span class="fu">fct_relabel</span>(agequint, convert_agegrp), </span>
<span id="cb159-6"><a aria-hidden="true" tabindex="-1"></a>              <span class="at">year_f =</span> <span class="fu">droplevels</span>(<span class="fu">factor</span>(year)),<span class="co">#&lt;&lt; </span></span>
<span id="cb159-7"><a aria-hidden="true" tabindex="-1"></a>              <span class="at">young =</span> <span class="fu">ifelse</span>(age <span class="sc">&lt;</span> <span class="dv">26</span>, <span class="st">"Yes"</span>, <span class="st">"No"</span>), </span>
<span id="cb159-8"><a aria-hidden="true" tabindex="-1"></a>              <span class="at">fefam_d =</span> <span class="fu">fct_recode</span>(fefam,</span>
<span id="cb159-9"><a aria-hidden="true" tabindex="-1"></a>                                  <span class="at">Agree =</span> <span class="st">"Strongly Agree"</span>,</span>
<span id="cb159-10"><a aria-hidden="true" tabindex="-1"></a>                                  <span class="at">Disagree =</span> <span class="st">"Strongly Disagree"</span>),</span>
<span id="cb159-11"><a aria-hidden="true" tabindex="-1"></a>              <span class="at">degree =</span> <span class="fu">factor</span>(degree, </span>
<span id="cb159-12"><a aria-hidden="true" tabindex="-1"></a>                             <span class="at">levels =</span> <span class="fu">levels</span>(gss_sub<span class="sc">$</span>degree), </span>
<span id="cb159-13"><a aria-hidden="true" tabindex="-1"></a>                             <span class="at">ordered =</span> <span class="cn">TRUE</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</div>
</section>
<section id="how-wed-actually-write-this-2" class="slide level2">
<h2>How we’d actually write this</h2>
<div class="smallcode">
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb160" data-source-line-numbers="nil" data-code-line-numbers="7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb160-1"><a aria-hidden="true" tabindex="-1"></a>gss_sub <span class="ot">&lt;-</span> gss_sub <span class="sc">|&gt;</span></span>
<span id="cb160-2"><a aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">agequint =</span> <span class="fu">cut</span>(<span class="at">x =</span> age, </span>
<span id="cb160-3"><a aria-hidden="true" tabindex="-1"></a>                          <span class="at">breaks =</span> <span class="fu">unique</span>(age_quintiles), </span>
<span id="cb160-4"><a aria-hidden="true" tabindex="-1"></a>                          <span class="at">include.lowest =</span> <span class="cn">TRUE</span>), </span>
<span id="cb160-5"><a aria-hidden="true" tabindex="-1"></a>            <span class="at">agequint =</span> <span class="fu">fct_relabel</span>(agequint, convert_agegrp), </span>
<span id="cb160-6"><a aria-hidden="true" tabindex="-1"></a>            <span class="at">year_f =</span> <span class="fu">factor</span>(year),  </span>
<span id="cb160-7"><a aria-hidden="true" tabindex="-1"></a>            <span class="at">young =</span> <span class="fu">ifelse</span>(age <span class="sc">&lt;</span> <span class="dv">26</span>, <span class="st">"Yes"</span>, <span class="st">"No"</span>),</span>
<span id="cb160-8"><a aria-hidden="true" tabindex="-1"></a>            <span class="at">fefam_d =</span> <span class="fu">fct_recode</span>(fefam,</span>
<span id="cb160-9"><a aria-hidden="true" tabindex="-1"></a>                                <span class="at">Agree =</span> <span class="st">"Strongly Agree"</span>,</span>
<span id="cb160-10"><a aria-hidden="true" tabindex="-1"></a>                                <span class="at">Disagree =</span> <span class="st">"Strongly Disagree"</span>),</span>
<span id="cb160-11"><a aria-hidden="true" tabindex="-1"></a>            <span class="at">degree =</span> <span class="fu">factor</span>(degree, </span>
<span id="cb160-12"><a aria-hidden="true" tabindex="-1"></a>                           <span class="at">levels =</span> <span class="fu">levels</span>(gss_sub<span class="sc">$</span>degree), </span>
<span id="cb160-13"><a aria-hidden="true" tabindex="-1"></a>                           <span class="at">ordered =</span> <span class="cn">TRUE</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</div>
</section>
<section id="how-wed-actually-write-this-3" class="slide level2">
<h2>How we’d actually write this</h2>
<div class="smallcode">
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb161" data-source-line-numbers="nil" data-code-line-numbers="13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb161-1"><a aria-hidden="true" tabindex="-1"></a>gss_sub <span class="ot">&lt;-</span> gss_sub <span class="sc">|&gt;</span></span>
<span id="cb161-2"><a aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">agequint =</span> <span class="fu">cut</span>(<span class="at">x =</span> age, </span>
<span id="cb161-3"><a aria-hidden="true" tabindex="-1"></a>                          <span class="at">breaks =</span> <span class="fu">unique</span>(age_quintiles), </span>
<span id="cb161-4"><a aria-hidden="true" tabindex="-1"></a>                          <span class="at">include.lowest =</span> <span class="cn">TRUE</span>), </span>
<span id="cb161-5"><a aria-hidden="true" tabindex="-1"></a>            <span class="at">agequint =</span> <span class="fu">fct_relabel</span>(agequint, convert_agegrp), </span>
<span id="cb161-6"><a aria-hidden="true" tabindex="-1"></a>            <span class="at">year_f =</span> <span class="fu">droplevels</span>(<span class="fu">factor</span>(year)),  </span>
<span id="cb161-7"><a aria-hidden="true" tabindex="-1"></a>            <span class="at">young =</span> <span class="fu">ifelse</span>(age <span class="sc">&lt;</span> <span class="dv">26</span>, <span class="st">"Yes"</span>, <span class="st">"No"</span>), </span>
<span id="cb161-8"><a aria-hidden="true" tabindex="-1"></a>            <span class="at">fefam_d =</span> <span class="fu">fct_recode</span>(fefam,</span>
<span id="cb161-9"><a aria-hidden="true" tabindex="-1"></a>                                <span class="at">Agree =</span> <span class="st">"Strongly Agree"</span>,</span>
<span id="cb161-10"><a aria-hidden="true" tabindex="-1"></a>                                <span class="at">Disagree =</span> <span class="st">"Strongly Disagree"</span>),</span>
<span id="cb161-11"><a aria-hidden="true" tabindex="-1"></a>            <span class="at">degree =</span> <span class="fu">factor</span>(degree, </span>
<span id="cb161-12"><a aria-hidden="true" tabindex="-1"></a>                           <span class="at">levels =</span> <span class="fu">levels</span>(gss_sub<span class="sc">$</span>degree), </span>
<span id="cb161-13"><a aria-hidden="true" tabindex="-1"></a>                           <span class="at">ordered =</span> <span class="cn">TRUE</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</div>
</section>
<section id="gss-panel" class="slide level2">
<h2>GSS Panel</h2>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb162" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb162-1"><a aria-hidden="true" tabindex="-1"></a>gss_sub <span class="sc">|&gt;</span> </span>
<span id="cb162-2"><a aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(sex, year, year_f, age, young, fefam, fefam_d) <span class="sc">|&gt;</span> </span>
<span id="cb162-3"><a aria-hidden="true" tabindex="-1"></a>  <span class="fu">sample_n</span>(<span class="dv">15</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre data-code-line-numbers=""><code># A tibble: 15 × 7
   sex     year year_f   age young fefam             fefam_d 
   &lt;fct&gt;  &lt;int&gt; &lt;fct&gt;  &lt;int&gt; &lt;chr&gt; &lt;fct&gt;             &lt;fct&gt;   
 1 Male    2014 2014      49 No    Disagree          Disagree
 2 Male    2014 2014      44 No    &lt;NA&gt;              &lt;NA&gt;    
 3 Male    2010 2010      25 Yes   Disagree          Disagree
 4 Male    2010 2010      89 No    &lt;NA&gt;              &lt;NA&gt;    
 5 Male    2012 2012      56 No    Agree             Agree   
 6 Female  2006 2006      41 No    Strongly Disagree Disagree
 7 Male    2006 2006      66 No    Strongly Agree    Agree   
 8 Male    2012 2012      70 No    Agree             Agree   
 9 Female  2014 2014      54 No    &lt;NA&gt;              &lt;NA&gt;    
10 Female  2008 2008      65 No    &lt;NA&gt;              &lt;NA&gt;    
11 Female  2008 2008      35 No    Agree             Agree   
12 Male    2006 2006      25 Yes   &lt;NA&gt;              &lt;NA&gt;    
13 Female  2008 2008      39 No    &lt;NA&gt;              &lt;NA&gt;    
14 Male    2008 2008      34 No    Agree             Agree   
15 Female  2014 2014      39 No    &lt;NA&gt;              &lt;NA&gt;    </code></pre>
</div>
</div>
</section>
<section id="gss-panel-1" class="slide level2">
<h2>GSS Panel</h2>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb164" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb164-1"><a aria-hidden="true" tabindex="-1"></a>gss_sub <span class="sc">|&gt;</span> </span>
<span id="cb164-2"><a aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(sex, degree) <span class="sc">|&gt;</span> </span>
<span id="cb164-3"><a aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(sex, degree) <span class="sc">|&gt;</span> </span>
<span id="cb164-4"><a aria-hidden="true" tabindex="-1"></a>  <span class="fu">tally</span>() <span class="sc">|&gt;</span> </span>
<span id="cb164-5"><a aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> sex, <span class="at">values_from =</span> n)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre data-code-line-numbers=""><code># A tibble: 6 × 3
  degree          Male Female
  &lt;ord&gt;          &lt;int&gt;  &lt;int&gt;
1 Lt High School   814   1036
2 High School     3131   4143
3 Junior College   440    721
4 Bachelor        1293   1474
5 Graduate         696    860
6 &lt;NA&gt;              NA      2</code></pre>
</div>
</div>
</section></section>
<section>
<section id="more-about-factors" class="title-slide slide level1 inv-title center" data-background-color="#252F3E">
<h1>More about factors</h1>

</section>
<section id="more-on-factors" class="slide level2">
<h2>More on <span class="fg-yellow">factors</span></h2>
<ul>
<li>We’ve already seen <span class="fg-green"><strong><code>fct_relabel()</code></strong></span> and <span class="fg-green"><strong><code>fct_recode()</code></strong></span> from forcats.</li>
<li>There are numerous other convenience functions for factors.</li>
</ul>
</section>
<section id="more-on-factors-1" class="slide level2">
<h2>More on <span class="fg-yellow">factors</span></h2>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb166" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb166-1"><a aria-hidden="true" tabindex="-1"></a>gss_sub <span class="sc">|&gt;</span> </span>
<span id="cb166-2"><a aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(degree)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre data-code-line-numbers=""><code># A tibble: 6 × 2
  degree             n
  &lt;ord&gt;          &lt;int&gt;
1 Lt High School  1850
2 High School     7274
3 Junior College  1161
4 Bachelor        2767
5 Graduate        1556
6 &lt;NA&gt;               2</code></pre>
</div>
</div>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb168" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb168-1"><a aria-hidden="true" tabindex="-1"></a><span class="fu">levels</span>(gss_sub<span class="sc">$</span>degree)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre data-code-line-numbers=""><code>[1] "Lt High School" "High School"    "Junior College" "Bachelor"      
[5] "Graduate"      </code></pre>
</div>
</div>
</section>
<section id="more-on-factors-2" class="slide level2">
<h2>More on <span class="fg-yellow">factors</span></h2>
<ul>
<li>Make the <span class="fg-red">NA</span> values an explicit level</li>
</ul>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb170" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb170-1"><a aria-hidden="true" tabindex="-1"></a>gss_sub <span class="sc">|&gt;</span> </span>
<span id="cb170-2"><a aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">degree_na =</span> <span class="fu">fct_na_value_to_level</span>(degree)) <span class="sc">|&gt;</span> </span>
<span id="cb170-3"><a aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(degree_na)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre data-code-line-numbers=""><code># A tibble: 6 × 2
  degree_na          n
  &lt;ord&gt;          &lt;int&gt;
1 Lt High School  1850
2 High School     7274
3 Junior College  1161
4 Bachelor        2767
5 Graduate        1556
6 &lt;NA&gt;               2</code></pre>
</div>
</div>
<p>There’s also <code>fct_na_level_to_value()</code> to go the other way.</p>
</section>
<section id="more-on-factors-3" class="slide level2">
<h2>More on <span class="fg-yellow">factors</span></h2>
<ul>
<li>Relevel by frequency</li>
</ul>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb172" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb172-1"><a aria-hidden="true" tabindex="-1"></a>gss_sub <span class="sc">|&gt;</span> </span>
<span id="cb172-2"><a aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">degree_freq =</span> <span class="fu">fct_infreq</span>(degree)) <span class="sc">|&gt;</span> </span>
<span id="cb172-3"><a aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(degree_freq) </span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre data-code-line-numbers=""><code># A tibble: 6 × 2
  degree_freq        n
  &lt;ord&gt;          &lt;int&gt;
1 High School     7274
2 Bachelor        2767
3 Lt High School  1850
4 Graduate        1556
5 Junior College  1161
6 &lt;NA&gt;               2</code></pre>
</div>
</div>
</section>
<section id="more-on-factors-4" class="slide level2">
<h2>More on <span class="fg-yellow">factors</span></h2>
<ul>
<li>Relevel manually</li>
</ul>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb174" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb174-1"><a aria-hidden="true" tabindex="-1"></a><span class="fu">is.ordered</span>(gss_sub<span class="sc">$</span>sex)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre data-code-line-numbers=""><code>[1] FALSE</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb176" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb176-1"><a aria-hidden="true" tabindex="-1"></a><span class="fu">levels</span>(gss_sub<span class="sc">$</span>sex)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre data-code-line-numbers=""><code>[1] "Male"   "Female"</code></pre>
</div>
</div>
</section>
<section id="more-on-factors-5" class="slide level2">
<h2>More on <span class="fg-yellow">factors</span></h2>
<ul>
<li>Relevel manually</li>
</ul>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb178" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb178-1"><a aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(<span class="fu">lm</span>(age <span class="sc">~</span> sex, <span class="at">data =</span> gss_sub))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre data-code-line-numbers=""><code>
Call:
lm(formula = age ~ sex, data = gss_sub)

Residuals:
    Min      1Q  Median      3Q     Max 
-31.431 -13.972  -0.431  12.569  40.028 

Coefficients:
            Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)  48.9720     0.2149 227.846   &lt;2e-16 ***
sexFemale     0.4594     0.2864   1.604    0.109    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 17.08 on 14463 degrees of freedom
  (145 observations deleted due to missingness)
Multiple R-squared:  0.0001779, Adjusted R-squared:  0.0001088 
F-statistic: 2.573 on 1 and 14463 DF,  p-value: 0.1087</code></pre>
</div>
</div>
</section>
<section id="more-on-factors-6" class="slide level2">
<h2>More on <span class="fg-yellow">factors</span></h2>
<ul>
<li>Relevel manually</li>
</ul>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb180" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb180-1"><a aria-hidden="true" tabindex="-1"></a>gss_sub <span class="ot">&lt;-</span> gss_sub <span class="sc">|&gt;</span> </span>
<span id="cb180-2"><a aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">sex =</span> <span class="fu">fct_relevel</span>(sex, <span class="st">"Female"</span>))</span>
<span id="cb180-3"><a aria-hidden="true" tabindex="-1"></a></span>
<span id="cb180-4"><a aria-hidden="true" tabindex="-1"></a><span class="fu">levels</span>(gss_sub<span class="sc">$</span>sex)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre data-code-line-numbers=""><code>[1] "Female" "Male"  </code></pre>
</div>
</div>
</section>
<section id="more-on-factors-7" class="slide level2">
<h2>More on <span class="fg-yellow">factors</span></h2>
<ul>
<li>Relevel manually</li>
</ul>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb182" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb182-1"><a aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(<span class="fu">lm</span>(age <span class="sc">~</span> sex, <span class="at">data =</span> gss_sub))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre data-code-line-numbers=""><code>
Call:
lm(formula = age ~ sex, data = gss_sub)

Residuals:
    Min      1Q  Median      3Q     Max 
-31.431 -13.972  -0.431  12.569  40.028 

Coefficients:
            Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)  49.4313     0.1892 261.233   &lt;2e-16 ***
sexMale      -0.4594     0.2864  -1.604    0.109    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 17.08 on 14463 degrees of freedom
  (145 observations deleted due to missingness)
Multiple R-squared:  0.0001779, Adjusted R-squared:  0.0001088 
F-statistic: 2.573 on 1 and 14463 DF,  p-value: 0.1087</code></pre>
</div>
</div>
</section>
<section id="more-on-factors-8" class="slide level2">
<h2>More on <span class="fg-yellow">factors</span></h2>
<ul>
<li>Interact or cross factors</li>
</ul>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb184" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb184-1"><a aria-hidden="true" tabindex="-1"></a>gss_sub <span class="ot">&lt;-</span> gss_sub <span class="sc">|&gt;</span> </span>
<span id="cb184-2"><a aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">degree_by_race =</span> <span class="fu">fct_cross</span>(race, degree))</span>
<span id="cb184-3"><a aria-hidden="true" tabindex="-1"></a></span>
<span id="cb184-4"><a aria-hidden="true" tabindex="-1"></a>gss_sub <span class="sc">|&gt;</span> </span>
<span id="cb184-5"><a aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(degree_by_race)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre data-code-line-numbers=""><code># A tibble: 16 × 2
   degree_by_race           n
   &lt;fct&gt;                &lt;int&gt;
 1 White:Lt High School  1188
 2 White:High School     5548
 3 White:Junior College   885
 4 White:Bachelor        2334
 5 White:Graduate        1293
 6 Black:Lt High School   379
 7 Black:High School     1180
 8 Black:Junior College   206
 9 Black:Bachelor         233
10 Black:Graduate         116
11 Other:Lt High School   283
12 Other:High School      546
13 Other:Junior College    70
14 Other:Bachelor         200
15 Other:Graduate         147
16 &lt;NA&gt;                     2</code></pre>
</div>
</div>
</section>
<section id="more-on-factors-9" class="slide level2">
<h2>More on <span class="fg-yellow">factors</span></h2>
<ul>
<li>Relevel manually by lumping … the least frequent n</li>
</ul>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb186" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb186-1"><a aria-hidden="true" tabindex="-1"></a>gss_sub <span class="sc">|&gt;</span> </span>
<span id="cb186-2"><a aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">degree_n =</span> <span class="fu">fct_lump_n</span>(degree, <span class="at">n =</span> <span class="dv">3</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb186-3"><a aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(degree_n)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre data-code-line-numbers=""><code># A tibble: 5 × 2
  degree_n           n
  &lt;ord&gt;          &lt;int&gt;
1 Lt High School  1850
2 High School     7274
3 Bachelor        2767
4 Other           2717
5 &lt;NA&gt;               2</code></pre>
</div>
</div>
</section>
<section id="more-on-factors-10" class="slide level2">
<h2>More on <span class="fg-yellow">factors</span></h2>
<p>Relevel manually by lumping …to other, manually</p>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb188" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb188-1"><a aria-hidden="true" tabindex="-1"></a>gss_sub <span class="sc">|&gt;</span> </span>
<span id="cb188-2"><a aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">degree_o =</span> <span class="fu">fct_other</span>(degree, </span>
<span id="cb188-3"><a aria-hidden="true" tabindex="-1"></a>                              <span class="at">keep =</span> <span class="fu">c</span>(<span class="st">"Lt High School"</span>, </span>
<span id="cb188-4"><a aria-hidden="true" tabindex="-1"></a>                                       <span class="st">"High School"</span>))) <span class="sc">|&gt;</span> </span>
<span id="cb188-5"><a aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(degree_o)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre data-code-line-numbers=""><code># A tibble: 4 × 2
  degree_o           n
  &lt;ord&gt;          &lt;int&gt;
1 Lt High School  1850
2 High School     7274
3 Other           5484
4 &lt;NA&gt;               2</code></pre>
</div>
</div>


</section></section>
    </div>
  <div class="quarto-auto-generated-content" style="display: none;">
<div class="footer footer-default">

</div>
</div></div>

  <script>window.backupDefine = window.define; window.define = undefined;</script>
  <script src="../site_libs/revealjs/dist/reveal.js"></script>
  <!-- reveal.js plugins -->
  <script src="../site_libs/revealjs/plugin/quarto-line-highlight/line-highlight.js"></script>
  <script src="../site_libs/revealjs/plugin/pdf-export/pdfexport.js"></script>
  <script src="../site_libs/revealjs/plugin/reveal-menu/menu.js"></script>
  <script src="../site_libs/revealjs/plugin/reveal-menu/quarto-menu.js"></script>
  <script src="../site_libs/revealjs/plugin/quarto-support/support.js"></script>
  

  <script src="../site_libs/revealjs/plugin/notes/notes.js"></script>
  <script src="../site_libs/revealjs/plugin/search/search.js"></script>
  <script src="../site_libs/revealjs/plugin/zoom/zoom.js"></script>
  <script src="../site_libs/revealjs/plugin/math/math.js"></script>
  <script>window.define = window.backupDefine; window.backupDefine = undefined;</script>

  <script>

      // Full list of configuration options available at:
      // https://revealjs.com/config/
      Reveal.initialize({
'controlsAuto': true,
'previewLinksAuto': false,
'pdfSeparateFragments': false,
'autoAnimateEasing': "ease",
'autoAnimateDuration': 1,
'autoAnimateUnmatched': true,
'jumpToSlide': true,
'menu': {"side":"left","useTextContentForMissingTitles":true,"markers":false,"loadIcons":false,"custom":[{"title":"Tools","icon":"<i class=\"fas fa-gear\"></i>","content":"<ul class=\"slide-menu-items\">\n<li class=\"slide-tool-item active\" data-item=\"0\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.fullscreen(event)\"><kbd>f</kbd> Fullscreen</a></li>\n<li class=\"slide-tool-item\" data-item=\"1\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.speakerMode(event)\"><kbd>s</kbd> Speaker View</a></li>\n<li class=\"slide-tool-item\" data-item=\"2\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.overview(event)\"><kbd>o</kbd> Slide Overview</a></li>\n<li class=\"slide-tool-item\" data-item=\"3\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.togglePdfExport(event)\"><kbd>e</kbd> PDF Export Mode</a></li>\n<li class=\"slide-tool-item\" data-item=\"4\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.toggleScrollView(event)\"><kbd>r</kbd> Scroll View Mode</a></li>\n<li class=\"slide-tool-item\" data-item=\"5\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.keyboardHelp(event)\"><kbd>?</kbd> Keyboard Help</a></li>\n</ul>"}],"openButton":true},
'smaller': false,
 
        // Display controls in the bottom right corner
        controls: false,

        // Help the user learn the controls by providing hints, for example by
        // bouncing the down arrow when they first encounter a vertical slide
        controlsTutorial: false,

        // Determines where controls appear, "edges" or "bottom-right"
        controlsLayout: 'edges',

        // Visibility rule for backwards navigation arrows; "faded", "hidden"
        // or "visible"
        controlsBackArrows: 'faded',

        // Display a presentation progress bar
        progress: true,

        // Display the page number of the current slide
        slideNumber: false,

        // 'all', 'print', or 'speaker'
        showSlideNumber: 'all',

        // Add the current slide number to the URL hash so that reloading the
        // page/copying the URL will return you to the same slide
        hash: true,

        // Start with 1 for the hash rather than 0
        hashOneBasedIndex: false,

        // Flags if we should monitor the hash and change slides accordingly
        respondToHashChanges: true,

        // Push each slide change to the browser history
        history: true,

        // Enable keyboard shortcuts for navigation
        keyboard: true,

        // Enable the slide overview mode
        overview: true,

        // Disables the default reveal.js slide layout (scaling and centering)
        // so that you can use custom CSS layout
        disableLayout: false,

        // Vertical centering of slides
        center: false,

        // Enables touch navigation on devices with touch input
        touch: true,

        // Loop the presentation
        loop: false,

        // Change the presentation direction to be RTL
        rtl: false,

        // see https://revealjs.com/vertical-slides/#navigation-mode
        navigationMode: 'linear',

        // Randomizes the order of slides each time the presentation loads
        shuffle: false,

        // Turns fragments on and off globally
        fragments: true,

        // Flags whether to include the current fragment in the URL,
        // so that reloading brings you to the same fragment position
        fragmentInURL: false,

        // Flags if the presentation is running in an embedded mode,
        // i.e. contained within a limited portion of the screen
        embedded: false,

        // Flags if we should show a help overlay when the questionmark
        // key is pressed
        help: true,

        // Flags if it should be possible to pause the presentation (blackout)
        pause: true,

        // Flags if speaker notes should be visible to all viewers
        showNotes: false,

        // Global override for autoplaying embedded media (null/true/false)
        autoPlayMedia: null,

        // Global override for preloading lazy-loaded iframes (null/true/false)
        preloadIframes: null,

        // Number of milliseconds between automatically proceeding to the
        // next slide, disabled when set to 0, this value can be overwritten
        // by using a data-autoslide attribute on your slides
        autoSlide: 0,

        // Stop auto-sliding after user input
        autoSlideStoppable: true,

        // Use this method for navigation when auto-sliding
        autoSlideMethod: null,

        // Specify the average time in seconds that you think you will spend
        // presenting each slide. This is used to show a pacing timer in the
        // speaker view
        defaultTiming: null,

        // Enable slide navigation via mouse wheel
        mouseWheel: false,

        // The display mode that will be used to show slides
        display: 'block',

        // Hide cursor if inactive
        hideInactiveCursor: true,

        // Time before the cursor is hidden (in ms)
        hideCursorTime: 5000,

        // Opens links in an iframe preview overlay
        previewLinks: false,

        // Transition style (none/fade/slide/convex/concave/zoom)
        transition: 'fade',

        // Transition speed (default/fast/slow)
        transitionSpeed: 'slow',

        // Transition style for full page slide backgrounds
        // (none/fade/slide/convex/concave/zoom)
        backgroundTransition: 'none',

        // Number of slides away from the current that are visible
        viewDistance: 3,

        // Number of slides away from the current that are visible on mobile
        // devices. It is advisable to set this to a lower number than
        // viewDistance in order to save resources.
        mobileViewDistance: 2,

        // The "normal" size of the presentation, aspect ratio will be preserved
        // when the presentation is scaled to fit different resolutions. Can be
        // specified using percentage units.
        width: 1050,

        height: 700,

        // Factor of the display size that should remain empty around the content
        margin: 0.1,

        math: {
          mathjax: 'https://cdn.jsdelivr.net/npm/mathjax@2.7.9/MathJax.js',
          config: 'TeX-AMS_HTML-full',
          tex2jax: {
            inlineMath: [['\\(','\\)']],
            displayMath: [['\\[','\\]']],
            balanceBraces: true,
            processEscapes: false,
            processRefs: true,
            processEnvironments: true,
            preview: 'TeX',
            skipTags: ['script','noscript','style','textarea','pre','code'],
            ignoreClass: 'tex2jax_ignore',
            processClass: 'tex2jax_process'
          },
        },

        // reveal.js plugins
        plugins: [QuartoLineHighlight, PdfExport, RevealMenu, QuartoSupport,

          RevealMath,
          RevealNotes,
          RevealSearch,
          RevealZoom
        ]
      });
    </script>
    
    <script>
      // htmlwidgets need to know to resize themselves when slides are shown/hidden.
      // Fire the "slideenter" event (handled by htmlwidgets.js) when the current
      // slide changes (different for each slide format).
      (function () {
        // dispatch for htmlwidgets
        function fireSlideEnter() {
          const event = window.document.createEvent("Event");
          event.initEvent("slideenter", true, true);
          window.document.dispatchEvent(event);
        }

        function fireSlideChanged(previousSlide, currentSlide) {
          fireSlideEnter();

          // dispatch for shiny
          if (window.jQuery) {
            if (previousSlide) {
              window.jQuery(previousSlide).trigger("hidden");
            }
            if (currentSlide) {
              window.jQuery(currentSlide).trigger("shown");
            }
          }
        }

        // hookup for slidy
        if (window.w3c_slidy) {
          window.w3c_slidy.add_observer(function (slide_num) {
            // slide_num starts at position 1
            fireSlideChanged(null, w3c_slidy.slides[slide_num - 1]);
          });
        }

      })();
    </script>

    <script id="quarto-html-after-body" type="application/javascript">
      window.document.addEventListener("DOMContentLoaded", function (event) {
        const tabsets =  window.document.querySelectorAll(".panel-tabset-tabby")
        tabsets.forEach(function(tabset) {
          const tabby = new Tabby('#' + tabset.id);
        });
        const isCodeAnnotation = (el) => {
          for (const clz of el.classList) {
            if (clz.startsWith('code-annotation-')) {                     
              return true;
            }
          }
          return false;
        }
        const onCopySuccess = function(e) {
          // button target
          const button = e.trigger;
          // don't keep focus
          button.blur();
          // flash "checked"
          button.classList.add('code-copy-button-checked');
          var currentTitle = button.getAttribute("title");
          button.setAttribute("title", "Copied!");
          let tooltip;
          if (window.bootstrap) {
            button.setAttribute("data-bs-toggle", "tooltip");
            button.setAttribute("data-bs-placement", "left");
            button.setAttribute("data-bs-title", "Copied!");
            tooltip = new bootstrap.Tooltip(button, 
              { trigger: "manual", 
                customClass: "code-copy-button-tooltip",
                offset: [0, -8]});
            tooltip.show();    
          }
          setTimeout(function() {
            if (tooltip) {
              tooltip.hide();
              button.removeAttribute("data-bs-title");
              button.removeAttribute("data-bs-toggle");
              button.removeAttribute("data-bs-placement");
            }
            button.setAttribute("title", currentTitle);
            button.classList.remove('code-copy-button-checked');
          }, 1000);
          // clear code selection
          e.clearSelection();
        }
        const getTextToCopy = function(trigger) {
          const outerScaffold = trigger.parentElement.cloneNode(true);
          const codeEl = outerScaffold.querySelector('code');
          for (const childEl of codeEl.children) {
            if (isCodeAnnotation(childEl)) {
              childEl.remove();
            }
          }
          return codeEl.innerText;
        }
        const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
          text: getTextToCopy
        });
        clipboard.on('success', onCopySuccess);
        if (window.document.getElementById('quarto-embedded-source-code-modal')) {
          const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
            text: getTextToCopy,
            container: window.document.getElementById('quarto-embedded-source-code-modal')
          });
          clipboardModal.on('success', onCopySuccess);
        }
          var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
          var mailtoRegex = new RegExp(/^mailto:/);
            var filterRegex = new RegExp("https:\/\/kjhealy\.github\.io\/data_wrangling");
          var isInternal = (href) => {
              return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
          }
          // Inspect non-navigation links and adorn them if external
         var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
          for (var i=0; i<links.length; i++) {
            const link = links[i];
            if (!isInternal(link.href)) {
              // undo the damage that might have been done by quarto-nav.js in the case of
              // links that we want to consider external
              if (link.dataset.originalHref !== undefined) {
                link.href = link.dataset.originalHref;
              }
            }
          }
        function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
          const config = {
            allowHTML: true,
            maxWidth: 500,
            delay: 100,
            arrow: false,
            appendTo: function(el) {
                return el.closest('section.slide') || el.parentElement;
            },
            interactive: true,
            interactiveBorder: 10,
            theme: 'light-border',
            placement: 'bottom-start',
          };
          if (contentFn) {
            config.content = contentFn;
          }
          if (onTriggerFn) {
            config.onTrigger = onTriggerFn;
          }
          if (onUntriggerFn) {
            config.onUntrigger = onUntriggerFn;
          }
            config['offset'] = [0,0];
            config['maxWidth'] = 700;
          window.tippy(el, config); 
        }
        const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
        for (var i=0; i<noterefs.length; i++) {
          const ref = noterefs[i];
          tippyHover(ref, function() {
            // use id or data attribute instead here
            let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
            try { href = new URL(href).hash; } catch {}
            const id = href.replace(/^#\/?/, "");
            const note = window.document.getElementById(id);
            if (note) {
              return note.innerHTML;
            } else {
              return "";
            }
          });
        }
        const findCites = (el) => {
          const parentEl = el.parentElement;
          if (parentEl) {
            const cites = parentEl.dataset.cites;
            if (cites) {
              return {
                el,
                cites: cites.split(' ')
              };
            } else {
              return findCites(el.parentElement)
            }
          } else {
            return undefined;
          }
        };
        var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
        for (var i=0; i<bibliorefs.length; i++) {
          const ref = bibliorefs[i];
          const citeInfo = findCites(ref);
          if (citeInfo) {
            tippyHover(citeInfo.el, function() {
              var popup = window.document.createElement('div');
              citeInfo.cites.forEach(function(cite) {
                var citeDiv = window.document.createElement('div');
                citeDiv.classList.add('hanging-indent');
                citeDiv.classList.add('csl-entry');
                var biblioDiv = window.document.getElementById('ref-' + cite);
                if (biblioDiv) {
                  citeDiv.innerHTML = biblioDiv.innerHTML;
                }
                popup.appendChild(citeDiv);
              });
              return popup.innerHTML;
            });
          }
        }
      });
      </script>
    

<script src="../site_libs/quarto-contrib/line-highlight-1.0.0/line-highlight.js" defer="true"></script>
</body></html>